<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>erg - autonomous headless daemon for claude code</title>
    <meta
      name="description"
      content="erg does the work. Autonomous headless daemon for Claude Code."
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,500;12..96,600;12..96,700;12..96,800&family=IBM+Plex+Sans:wght@400;500;600&family=IBM+Plex+Mono:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg: #141416;
        --bg-sidebar: #0f0f11;
        --bg-card: #1e1e21;
        --bg-code: #1a1a1d;
        --bg-inset: #111113;
        --accent: #f97316;
        --accent-dim: #ea580c;
        --accent-bg: rgba(249, 115, 22, 0.08);
        --accent-border: rgba(249, 115, 22, 0.2);
        --cyan: #22d3ee;
        --green: #34d399;
        --violet: #a78bfa;
        --text: #e4e4e7;
        --text-muted: #a1a1aa;
        --text-dim: #71717a;
        --border: #2a2a2e;
        --border-light: #3f3f46;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html {
        font-size: 100%;
        scroll-behavior: smooth;
        scroll-padding-top: 2rem;
      }

      body {
        font-family:
          "IBM Plex Sans",
          -apple-system,
          sans-serif;
        background: var(--bg);
        color: var(--text);
        line-height: 1.7;
        min-height: 100vh;
        -webkit-font-smoothing: antialiased;
        -webkit-text-size-adjust: 100%;
        text-size-adjust: 100%;
      }

      ::selection {
        background: var(--accent);
        color: #fff;
      }

      h1,
      h2,
      h3,
      h4 {
        font-family: "Bricolage Grotesque", sans-serif;
        letter-spacing: -0.02em;
      }

      code,
      pre {
        font-family: "IBM Plex Mono", monospace;
      }

      a {
        color: var(--accent);
        text-decoration: none;
      }

      a:hover {
        text-decoration: underline;
      }

      /* ---- Two-column layout ---- */

      .page {
        display: flex;
        min-height: 100vh;
      }

      /* ---- Sidebar ---- */

      .sidebar {
        width: 15rem;
        flex-shrink: 0;
        background: var(--bg-sidebar);
        border-right: 1px solid var(--border);
        position: sticky;
        top: 0;
        height: 100vh;
        overflow-y: auto;
        padding: 1.5rem 0;
        display: flex;
        flex-direction: column;
      }

      .sidebar-logo {
        padding: 0 1.25rem;
        margin-bottom: 1.75rem;
      }

      .sidebar-logo a {
        font-family: "Bricolage Grotesque", sans-serif;
        font-size: 2rem;
        font-weight: 800;
        color: var(--text);
        text-decoration: none;
        letter-spacing: -0.03em;
      }

      .sidebar-logo a span {
        color: var(--accent);
      }

      .sidebar-nav {
        list-style: none;
        flex: 1;
      }

      .sidebar-section {
        margin-bottom: 0.25rem;
      }

      .sidebar-section-title {
        display: block;
        padding: 0.4rem 1.25rem;
        font-size: 0.7rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-dim);
        margin-top: 0.75rem;
      }

      .sidebar-link {
        display: block;
        padding: 0.35rem 1.25rem 0.35rem 1.75rem;
        font-size: 0.85rem;
        color: var(--text-muted);
        text-decoration: none;
        transition:
          color 0.15s,
          background 0.15s;
        border-left: 2px solid transparent;
      }

      .sidebar-link:hover {
        color: var(--text);
        background: rgba(255, 255, 255, 0.03);
        text-decoration: none;
      }

      .sidebar-link.active {
        color: var(--accent);
        border-left-color: var(--accent);
        background: var(--accent-bg);
      }

      .sidebar-footer {
        padding: 1rem 1.25rem 0;
        border-top: 1px solid var(--border);
        margin-top: auto;
      }

      .sidebar-footer a {
        display: block;
        font-size: 0.78rem;
        color: var(--text-dim);
        padding: 0.2rem 0;
        text-decoration: none;
      }

      .sidebar-footer a:hover {
        color: var(--text-muted);
        text-decoration: none;
      }

      /* ---- Main content ---- */

      .main {
        flex: 1;
        min-width: 0;
        max-width: 820px;
        padding: 2.5rem 3rem 4rem;
      }

      /* ---- Content typography ---- */

      .main h1 {
        font-size: 2.5rem;
        font-weight: 800;
        color: var(--text);
        margin-bottom: 0.75rem;
      }

      .main h2 {
        font-size: 1.4rem;
        font-weight: 700;
        color: var(--text);
        margin-top: 3.5rem;
        margin-bottom: 1rem;
        padding-top: 1.5rem;
        border-top: 1px solid var(--border);
      }

      .main h2:first-of-type {
        margin-top: 2.5rem;
      }

      .main h3 {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text);
        margin-top: 2rem;
        margin-bottom: 0.5rem;
      }

      .main h4 {
        font-size: 0.95rem;
        font-weight: 600;
        color: var(--text);
        margin-top: 1.5rem;
        margin-bottom: 0.4rem;
      }

      .main p {
        margin-bottom: 1rem;
        color: var(--text-muted);
      }

      .main p code,
      .main li code {
        background: var(--bg-code);
        color: var(--cyan);
        padding: 0.15rem 0.4rem;
        border-radius: 4px;
        font-size: 0.85em;
        border: 1px solid var(--border);
      }

      .main ul,
      .main ol {
        margin-bottom: 1rem;
        padding-left: 1.5rem;
        color: var(--text-muted);
      }

      .main li {
        margin-bottom: 0.35rem;
        font-size: 0.95rem;
      }

      /* ---- Hero area ---- */

      .hero-badge {
        display: inline-block;
        font-family: "IBM Plex Mono", monospace;
        font-size: 0.65rem;
        font-weight: 600;
        color: var(--accent);
        background: transparent;
        border: 1px solid var(--accent-border);
        border-radius: 3px;
        padding: 0.2rem 0.6rem;
        margin-bottom: 1.25rem;
        letter-spacing: 0.05em;
        text-transform: uppercase;
      }

      .hero-tagline {
        font-family: "Bricolage Grotesque", sans-serif;
        font-size: 2.8rem;
        font-weight: 800;
        color: var(--text);
        margin-bottom: 1rem;
        letter-spacing: -0.03em;
        line-height: 1.1;
      }

      .hero-tagline-accent {
        background: linear-gradient(135deg, var(--accent), #fbbf24);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .hero-cta {
        display: inline-flex;
        gap: 0.75rem;
        margin-bottom: 0.5rem;
      }

      .btn {
        display: inline-flex;
        align-items: center;
        padding: 0.55rem 1.25rem;
        border-radius: 6px;
        font-family: "IBM Plex Sans", sans-serif;
        font-size: 0.85rem;
        font-weight: 500;
        text-decoration: none;
        transition: all 0.15s;
        border: 1px solid transparent;
      }

      .btn:hover {
        text-decoration: none;
      }

      .btn-primary {
        background: var(--accent);
        color: #fff;
      }

      .btn-primary:hover {
        background: var(--accent-dim);
      }

      .btn-ghost {
        background: transparent;
        color: var(--text-muted);
        border-color: var(--border-light);
      }

      .btn-ghost:hover {
        color: var(--text);
        border-color: var(--text-dim);
      }

      /* ---- Feature grid ---- */

      .feature-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.85rem;
        margin: 1rem 0 1.5rem;
      }

      .feature-item {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-left: 3px solid var(--accent);
        border-radius: 8px;
        padding: 1.25rem 1.4rem;
        transition:
          transform 0.15s,
          border-color 0.15s,
          box-shadow 0.15s;
      }

      .feature-item:nth-child(2) {
        border-left-color: var(--cyan);
      }
      .feature-item:nth-child(3) {
        border-left-color: var(--violet);
      }
      .feature-item:nth-child(4) {
        border-left-color: var(--green);
      }
      .feature-item:nth-child(5) {
        border-left-color: var(--cyan);
      }
      .feature-item:nth-child(6) {
        border-left-color: var(--violet);
      }

      .feature-item:hover {
        border-color: var(--border-light);
        transform: scale(1.01);
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.2);
      }
      .feature-item:hover {
        border-left-color: var(--accent);
      }
      .feature-item:nth-child(2):hover {
        border-left-color: var(--cyan);
      }
      .feature-item:nth-child(3):hover {
        border-left-color: var(--violet);
      }
      .feature-item:nth-child(4):hover {
        border-left-color: var(--green);
      }
      .feature-item:nth-child(5):hover {
        border-left-color: var(--cyan);
      }
      .feature-item:nth-child(6):hover {
        border-left-color: var(--violet);
      }

      .feature-item h4 {
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--text);
        margin: 0 0 0.35rem;
      }

      .feature-item .fi-icon {
        font-family: "IBM Plex Mono", monospace;
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--accent);
        margin-bottom: 0.65rem;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 2rem;
        height: 2rem;
        border-radius: 50%;
        background: var(--accent-bg);
        border: 1px solid var(--accent-border);
      }

      .feature-item:nth-child(2) .fi-icon {
        color: var(--cyan);
        background: rgba(34, 211, 238, 0.08);
        border-color: rgba(34, 211, 238, 0.2);
      }
      .feature-item:nth-child(3) .fi-icon {
        color: var(--violet);
        background: rgba(167, 139, 250, 0.08);
        border-color: rgba(167, 139, 250, 0.2);
      }
      .feature-item:nth-child(4) .fi-icon {
        color: var(--green);
        background: rgba(52, 211, 153, 0.08);
        border-color: rgba(52, 211, 153, 0.2);
      }
      .feature-item:nth-child(5) .fi-icon {
        color: var(--cyan);
        background: rgba(34, 211, 238, 0.08);
        border-color: rgba(34, 211, 238, 0.2);
      }
      .feature-item:nth-child(6) .fi-icon {
        color: var(--violet);
        background: rgba(167, 139, 250, 0.08);
        border-color: rgba(167, 139, 250, 0.2);
      }

      .feature-item p {
        font-size: 0.82rem;
        color: var(--text-muted);
        line-height: 1.6;
        margin: 0;
      }

      /* ---- Steps (how it works) ---- */

      .steps-list {
        list-style: none;
        padding: 0;
        margin: 1rem 0 1.5rem;
        counter-reset: step;
      }

      .steps-list li {
        counter-increment: step;
        display: flex;
        gap: 1rem;
        align-items: flex-start;
        padding: 0.75rem 0;
        border-bottom: 1px solid var(--border);
        margin: 0;
      }

      .steps-list li:last-child {
        border-bottom: none;
      }

      .steps-list li::before {
        content: counter(step);
        display: flex;
        align-items: center;
        justify-content: center;
        width: 1.75rem;
        height: 1.75rem;
        border-radius: 50%;
        background: var(--accent-bg);
        border: 1px solid var(--accent-border);
        color: var(--accent);
        font-family: "Bricolage Grotesque", sans-serif;
        font-size: 0.78rem;
        font-weight: 700;
        flex-shrink: 0;
        margin-top: 0.1rem;
      }

      .step-body h4 {
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--text);
        margin: 0 0 0.15rem;
      }

      .step-body p {
        font-size: 0.85rem;
        color: var(--text-muted);
        margin: 0;
      }

      /* ---- State diagram ---- */

      .state-flow {
        display: flex;
        align-items: flex-start;
        gap: 0;
        padding: 1.25rem 0;
        overflow-x: auto;
        margin: 0.5rem 0 0.75rem;
      }

      .sf-node {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.25rem;
        flex-shrink: 0;
      }

      .sf-box {
        font-family: "IBM Plex Mono", monospace;
        font-size: 0.78rem;
        font-weight: 500;
        padding: 0.45rem 0.85rem;
        border-radius: 6px;
        border: 1px solid var(--border);
        background: var(--bg-card);
        color: var(--text);
        white-space: nowrap;
        transition: border-color 0.15s;
      }

      .sf-box.sf-task {
        border-color: rgba(249, 115, 22, 0.3);
        background: rgba(249, 115, 22, 0.06);
      }
      .sf-box.sf-wait {
        border-color: rgba(167, 139, 250, 0.3);
        background: rgba(167, 139, 250, 0.06);
      }
      .sf-box.sf-done {
        border-color: rgba(52, 211, 153, 0.3);
        background: rgba(52, 211, 153, 0.06);
      }

      .sf-type {
        font-family: "IBM Plex Mono", monospace;
        font-size: 0.65rem;
        color: var(--text-dim);
      }

      .sf-step {
        display: flex;
        align-items: flex-start;
      }

      .sf-arrow {
        color: var(--text-dim);
        font-size: 0.75rem;
        padding: 0 0.35rem;
        flex-shrink: 0;
        user-select: none;
        line-height: 1;
        /* Match sf-box height: 0.78rem line + 0.45rem*2 padding + 2px border */
        height: calc(0.78rem * 1.75 + 0.9rem + 2px);
        display: flex;
        align-items: center;
      }

      .state-note {
        font-size: 0.82rem;
        color: var(--text-dim);
        margin-bottom: 1.5rem;
      }

      /* ---- Code block ---- */

      .code-block {
        background: var(--bg-inset);
        border: 1px solid var(--border);
        border-radius: 8px;
        overflow: hidden;
        margin: 1rem 0 1.5rem;
      }

      .code-header {
        background: var(--bg-card);
        border-bottom: 1px solid var(--border);
        padding: 0.5rem 1rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .code-filename {
        font-family: "IBM Plex Mono", monospace;
        font-size: 0.75rem;
        color: var(--text-dim);
      }

      .code-block pre {
        margin: 0;
        padding: 1rem 1.25rem;
        font-size: 0.8rem;
        line-height: 1.75;
        overflow-x: auto;
        color: var(--text-muted);
      }

      .code-block .ck {
        color: var(--accent);
      }
      .code-block .cv {
        color: var(--text);
      }
      .code-block .cc {
        color: var(--text-dim);
        font-style: italic;
      }
      .code-block .cs {
        color: var(--green);
      }
      .code-block .ca {
        color: var(--violet);
      }

      /* ---- Example tabs ---- */

      .example-tabs {
        margin: 1rem 0 1.5rem;
      }

      .tab-bar {
        display: flex;
        gap: 0.35rem;
        margin-bottom: 0.5rem;
      }

      .tab-btn {
        background: transparent;
        border: 1px solid var(--border);
        border-radius: 4px;
        color: var(--text-dim);
        padding: 0.3rem 0.8rem;
        font-family: "IBM Plex Mono", monospace;
        font-size: 0.73rem;
        cursor: pointer;
        transition:
          color 0.15s,
          border-color 0.15s,
          background 0.15s;
      }

      .tab-btn.active {
        color: var(--accent);
        border-color: var(--accent-border);
        background: var(--accent-bg);
      }

      .tab-btn:hover:not(.active) {
        color: var(--text-muted);
        border-color: var(--border-light);
      }

      .example-tabs [data-panel="yaml"] .code-block {
        margin: 0;
      }

      .diagram-panel {
        background: var(--bg-inset);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 1.5rem 1rem;
        overflow-x: auto;
      }

      .diagram-panel svg {
        max-width: 100%;
        height: auto;
        display: block;
        margin: 0 auto;
      }

      /* ---- Info cards ---- */

      .info-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
        margin: 1rem 0 1.5rem;
      }

      .info-card {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 1rem 1.15rem;
      }

      .info-card h4 {
        font-size: 0.88rem;
        font-weight: 600;
        color: var(--text);
        margin: 0 0 0.3rem;
      }

      .info-card p {
        font-size: 0.8rem;
        color: var(--text-muted);
        line-height: 1.6;
        margin: 0;
      }

      /* ---- CLI reference table ---- */

      .cli-table {
        width: 100%;
        border-collapse: collapse;
        margin: 1rem 0 1.5rem;
        font-size: 0.85rem;
      }

      .cli-table th {
        text-align: left;
        padding: 0.6rem 1rem;
        font-weight: 600;
        color: var(--text-dim);
        font-size: 0.72rem;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        border-bottom: 1px solid var(--border-light);
        background: var(--bg-card);
      }

      .cli-table td {
        padding: 0.6rem 1rem;
        border-bottom: 1px solid var(--border);
        color: var(--text-muted);
      }

      .cli-table td code {
        background: var(--bg-code);
        color: var(--cyan);
        padding: 0.15rem 0.4rem;
        border-radius: 3px;
        font-size: 0.82rem;
        border: 1px solid var(--border);
      }

      .cli-table tr:last-child td {
        border-bottom: none;
      }

      /* ---- Install block ---- */

      .install-block {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-left: 3px solid var(--accent);
        border-radius: 8px;
        padding: 0.9rem 1.25rem;
        position: relative;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin: 1rem 0;
        max-width: 520px;
      }

      .install-block .prompt-char {
        color: var(--accent);
        user-select: none;
        font-family: "IBM Plex Mono", monospace;
        font-weight: 500;
        font-size: 0.88rem;
      }

      .install-block code {
        font-size: 0.88rem;
        color: var(--text);
      }

      .copy-btn {
        position: absolute;
        right: 0.75rem;
        top: 50%;
        transform: translateY(-50%);
        background: var(--bg);
        border: 1px solid var(--border);
        color: var(--text-dim);
        padding: 0.3rem 0.65rem;
        border-radius: 4px;
        font-family: "IBM Plex Mono", monospace;
        font-size: 0.7rem;
        cursor: pointer;
        transition: all 0.15s;
      }

      .copy-btn:hover {
        border-color: var(--accent);
        color: var(--accent);
        box-shadow: 0 0 8px rgba(249, 115, 22, 0.15);
      }

      .copy-btn.copied {
        border-color: var(--green);
        color: var(--green);
      }

      /* ---- Mobile sidebar toggle ---- */

      .mobile-header {
        display: none;
        position: sticky;
        top: 0;
        z-index: 100;
        background: var(--bg-sidebar);
        border-bottom: 1px solid var(--border);
        padding: 0.75rem 1rem;
        align-items: center;
        justify-content: space-between;
      }

      .mobile-header .logo-text {
        font-family: "Bricolage Grotesque", sans-serif;
        font-size: 1.1rem;
        font-weight: 800;
        color: var(--text);
      }

      .mobile-header .logo-text span {
        color: var(--accent);
      }

      .menu-btn {
        background: none;
        border: 1px solid var(--border);
        color: var(--text-muted);
        padding: 0.3rem 0.6rem;
        border-radius: 4px;
        font-family: "IBM Plex Mono", monospace;
        font-size: 0.75rem;
        cursor: pointer;
      }

      /* ---- Responsive ---- */

      @media (max-width: 860px) {
        .sidebar {
          position: fixed;
          left: -16.25rem;
          z-index: 200;
          transition: left 0.25s ease;
          box-shadow: 4px 0 20px rgba(0, 0, 0, 0.5);
        }

        .sidebar.open {
          left: 0;
        }

        .sidebar-overlay {
          display: none;
          position: fixed;
          inset: 0;
          background: rgba(0, 0, 0, 0.5);
          z-index: 199;
        }

        .sidebar-overlay.open {
          display: block;
        }

        .mobile-header {
          display: flex;
        }

        .main {
          padding: 1.5rem 1.25rem 3rem;
        }

        .feature-grid,
        .info-grid {
          grid-template-columns: 1fr;
        }

        .feature-item,
        .info-card,
        .action-ref {
          overflow: hidden;
          overflow-wrap: break-word;
          word-break: break-word;
          min-width: 0;
        }

        .install-block {
          max-width: 100%;
          flex-wrap: wrap;
        }

        .cli-table {
          display: block;
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
        }

        .state-flow {
          padding: 1rem 0;
          flex-wrap: wrap;
        }
      }

      /* ---- Sidebar sub-links (category TOC) ---- */

      .sidebar-sublink {
        display: block;
        padding: 0.2rem 1.25rem 0.2rem 2.75rem;
        font-size: 0.75rem;
        font-family: "IBM Plex Mono", monospace;
        color: var(--text-dim);
        text-decoration: none;
        transition: color 0.15s;
        line-height: 1.5;
      }

      .sidebar-sublink:hover {
        color: var(--text-muted);
        text-decoration: none;
      }

      /* ---- Action reference ---- */

      .action-ref {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 1.25rem 1.5rem;
        margin-bottom: 1rem;
      }

      .action-header {
        display: flex;
        align-items: center;
        gap: 0.6rem;
        margin-bottom: 0.5rem;
      }

      .action-title {
        font-family: "IBM Plex Mono", monospace;
        font-size: 0.95rem;
        font-weight: 600;
        color: var(--accent);
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .action-title::before {
        content: "";
        display: inline-block;
        width: 7px;
        height: 7px;
        border-radius: 50%;
        background: var(--accent);
        flex-shrink: 0;
      }

      .action-header:has(.badge-async) .action-title::before {
        background: var(--violet);
      }

      .action-header:has(.badge-sync) .action-title::before {
        background: var(--green);
      }

      .action-desc {
        font-size: 0.88rem;
        color: var(--text-muted);
        margin-bottom: 0.75rem;
        line-height: 1.6;
      }

      .badge {
        display: inline-block;
        font-family: "IBM Plex Mono", monospace;
        font-size: 0.63rem;
        font-weight: 500;
        padding: 0.15rem 0.5rem;
        border-radius: 100px;
        flex-shrink: 0;
      }

      .badge-async {
        background: rgba(167, 139, 250, 0.1);
        border: 1px solid rgba(167, 139, 250, 0.25);
        color: var(--violet);
      }

      .badge-sync {
        background: rgba(52, 211, 153, 0.1);
        border: 1px solid rgba(52, 211, 153, 0.25);
        color: var(--green);
      }

      .param-section {
        margin-top: 0.85rem;
      }

      .param-section-title {
        font-size: 0.68rem;
        font-weight: 600;
        color: var(--text-dim);
        text-transform: uppercase;
        letter-spacing: 0.07em;
        margin-bottom: 0.4rem;
      }

      .param-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.82rem;
        border-radius: 6px;
        overflow: hidden;
        border: 1px solid var(--border);
      }

      .param-table th {
        text-align: left;
        padding: 0.4rem 0.75rem;
        font-size: 0.66rem;
        font-weight: 600;
        color: var(--text-dim);
        text-transform: uppercase;
        letter-spacing: 0.07em;
        background: var(--bg-inset);
        border-bottom: 1px solid var(--border-light);
      }

      .param-table td {
        padding: 0.45rem 0.75rem;
        border-bottom: 1px solid var(--border);
        color: var(--text-muted);
        vertical-align: top;
      }

      .param-table td:first-child {
        font-family: "IBM Plex Mono", monospace;
        color: var(--cyan);
        font-size: 0.8rem;
        white-space: nowrap;
      }

      .param-table td:nth-child(2) {
        font-family: "IBM Plex Mono", monospace;
        color: var(--text-dim);
        font-size: 0.78rem;
        white-space: nowrap;
      }

      .param-table tr:last-child td {
        border-bottom: none;
      }

      .param-none {
        font-size: 0.82rem;
        color: var(--text-dim);
        margin-top: 0.35rem;
      }

      @media (max-width: 480px) {
        .hero-tagline {
          font-size: 1.8rem;
        }

        .hero-cta {
          flex-direction: column;
        }

        .btn {
          width: 100%;
          justify-content: center;
          max-width: 280px;
        }

        .cli-table {
          font-size: 0.78rem;
        }

        .cli-table th,
        .cli-table td {
          padding: 0.5rem 0.6rem;
        }

        .code-block pre {
          font-size: 0.72rem;
          padding: 0.75rem 1rem;
        }

        .action-ref {
          padding: 1rem;
        }

        .action-title {
          font-size: 0.85rem;
        }

        .action-desc {
          font-size: 0.82rem;
        }
      }

      /* ---- Scrollable param-table on narrow phones ---- */
      @media (max-width: 560px) {
        .param-section {
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
          margin-left: -0.25rem;
          margin-right: -0.25rem;
        }

        .param-table {
          font-size: 0.75rem;
          width: max-content;
          min-width: 100%;
        }

        .param-table th {
          white-space: nowrap;
        }

        .param-table th,
        .param-table td {
          padding: 0.35rem 0.5rem;
        }

        .param-table td:first-child {
          font-size: 0.73rem;
        }

        .param-table td:nth-child(2) {
          font-size: 0.7rem;
        }

        .install-block {
          gap: 0.35rem;
        }

        .install-block code {
          font-size: 0.78rem;
        }

        .copy-btn {
          position: static;
          transform: none;
          flex-shrink: 0;
          padding: 0.25rem 0.5rem;
          font-size: 0.65rem;
        }
      }
    </style>
    <script src="./mermaid.min.js"></script>
  </head>
  <body>
    <div class="mobile-header">
      <span class="logo-text">erg<span>.</span></span>
      <button class="menu-btn" onclick="toggleSidebar()">menu</button>
    </div>

    <div
      class="sidebar-overlay"
      id="sidebarOverlay"
      onclick="toggleSidebar()"
    ></div>

    <div class="page">
      <!-- Sidebar -->
      <nav class="sidebar" id="sidebar">
        <div class="sidebar-logo">
          <a href="#">erg<span>.</span></a>
        </div>
        <ul class="sidebar-nav">
          <li class="sidebar-section">
            <span class="sidebar-section-title">Getting started</span>
            <a href="#overview" class="sidebar-link active">Overview</a>
            <a href="#how-it-works" class="sidebar-link">How it works</a>
            <a href="#install" class="sidebar-link">Installation</a>
            <a href="#quickstart-github" class="sidebar-sublink">GitHub</a>
            <a href="#quickstart-asana" class="sidebar-sublink">Asana</a>
            <a href="#quickstart-linear" class="sidebar-sublink">Linear</a>
          </li>
          <li class="sidebar-section">
            <span class="sidebar-section-title">Workflow</span>
            <a href="#workflow" class="sidebar-link">Configuration</a>
            <a href="#source-filter" class="sidebar-sublink">source.filter</a>
            <a href="#states" class="sidebar-link">State types</a>
            <a href="#state-task" class="sidebar-sublink">task</a>
            <a href="#state-wait" class="sidebar-sublink">wait</a>
            <a href="#state-choice" class="sidebar-sublink">choice</a>
            <a href="#state-pass" class="sidebar-sublink">pass</a>
            <a href="#error-handling" class="sidebar-link">Error handling</a>
            <a href="#hooks" class="sidebar-link">Hooks</a>
          </li>
          <li class="sidebar-section">
            <span class="sidebar-section-title">Reference</span>
            <a href="#cli" class="sidebar-link">CLI commands</a>
            <a href="#actions" class="sidebar-link">Actions</a>
            <a href="#actions-ai" class="sidebar-sublink">ai</a>
            <a href="#actions-github" class="sidebar-sublink">github</a>
            <a href="#actions-git" class="sidebar-sublink">git</a>
            <a href="#actions-asana" class="sidebar-sublink">asana</a>
            <a href="#actions-linear" class="sidebar-sublink">linear</a>
            <a href="#actions-slack" class="sidebar-sublink">slack</a>
            <a href="#actions-webhook" class="sidebar-sublink">webhook</a>
            <a href="#actions-workflow" class="sidebar-sublink">workflow</a>
            <a href="#events" class="sidebar-link">Wait events</a>
            <a href="#events-pr" class="sidebar-sublink">pr</a>
            <a href="#events-ci" class="sidebar-sublink">ci</a>
            <a href="#events-plan" class="sidebar-sublink">plan</a>
            <a href="#events-asana" class="sidebar-sublink">asana</a>
          </li>
          <li class="sidebar-section">
            <span class="sidebar-section-title">Examples</span>
            <a href="#example-minimal" class="sidebar-link">Minimal</a>
            <a href="#example-supervised" class="sidebar-link">Supervised</a>
            <a href="#example-ci-gate" class="sidebar-link">CI gate</a>
            <a href="#example-label-tracking" class="sidebar-link"
              >Label tracking</a
            >
            <a href="#example-asana-kanban" class="sidebar-link"
              >Asana kanban</a
            >
          </li>
        </ul>
        <div class="sidebar-footer">
          <a href="https://github.com/zhubert/erg">GitHub</a>
          <a href="https://github.com/zhubert/erg/issues">Issues</a>
        </div>
      </nav>

      <!-- Content -->
      <main class="main">
        <!-- Overview -->
        <section id="overview">
          <span class="hero-badge">autonomous coding daemon</span>
          <p class="hero-tagline">
            <span class="hero-tagline-accent">does the work.</span>
          </p>
          <p>
            Autonomous headless daemon for Claude Code. Polls GitHub, Asana, or
            Linear for issues, starts containerized Claude sessions, and drives
            the full PR lifecycle &mdash; as automated as your workflow allows.
          </p>
          <div class="hero-cta">
            <a href="#install" class="btn btn-primary">install</a>
            <a href="https://github.com/zhubert/erg" class="btn btn-ghost"
              >view on github</a
            >
          </div>
        </section>

        <div class="feature-grid">
          <div class="feature-item">
            <span class="fi-icon">#</span>
            <h4>issue polling</h4>
            <p>
              Polls GitHub, Asana, or Linear for new issues. Label an issue
              <code>queued</code> and the agent picks it up.
            </p>
          </div>
          <div class="feature-item">
            <span class="fi-icon">[ ]</span>
            <h4>containerized sessions</h4>
            <p>
              Every session runs inside a Docker container. The container is the
              sandbox &mdash; Claude has full permissions.
            </p>
          </div>
          <div class="feature-item">
            <span class="fi-icon">//</span>
            <h4>concurrent workers</h4>
            <p>
              Process multiple issues in parallel. Each gets its own branch,
              container, and Claude session.
            </p>
          </div>
          <div class="feature-item">
            <span class="fi-icon">&lt;&gt;</span>
            <h4>PR lifecycle</h4>
            <p>
              Creates PRs, addresses review comments, waits for CI, and
              auto-merges. Full lifecycle management.
            </p>
          </div>
          <div class="feature-item">
            <span class="fi-icon">~</span>
            <h4>workflow engine</h4>
            <p>
              Configurable state machine via <code>.erg/workflow.yaml</code>.
              Task, wait, choice, and pass states with retry, catch, and
              timeout.
            </p>
          </div>
          <div class="feature-item">
            <span class="fi-icon">*</span>
            <h4>automated workflow</h4>
            <p>
              From issue to merged PR: coding, CI fixes, review feedback, and
              merge — all managed by the workflow engine.
            </p>
          </div>
        </div>

        <!-- How it works -->
        <h2 id="how-it-works">How it works</h2>
        <p>
          At its core, erg is a
          <strong>state machine engine paired with AI coding</strong>. Each
          issue becomes a work item that advances through a configurable
          flowchart of states — from AI-generated code to a merged PR. You
          define exactly how much automation applies: require human review,
          auto-merge after CI, loop back for fixes, or notify external systems
          at any step.
        </p>
        <ol class="steps-list">
          <li>
            <div class="step-body">
              <h4>Tag or label an issue</h4>
              <p>
                Mark a task in GitHub, Asana, or Linear with the configured
                trigger label (e.g. <code>plan</code> or <code>queued</code>).
              </p>
            </div>
          </li>
          <li>
            <div class="step-body">
              <h4>Daemon picks it up</h4>
              <p>
                erg starts a containerized Claude session. With planning
                enabled, no branch is created yet — Claude reads the codebase in
                read-only mode.
              </p>
            </div>
          </li>
          <li>
            <div class="step-body">
              <h4>Claude analyzes and posts a plan</h4>
              <p>
                The <code>ai.plan</code> session explores the codebase and posts
                a structured implementation plan as an issue comment — no code
                written yet.
              </p>
            </div>
          </li>
          <li>
            <div class="step-body">
              <h4>You review and approve</h4>
              <p>
                Reply with approval (e.g. "LGTM") to proceed, or leave feedback.
                Claude revises the plan and loops back until you approve.
              </p>
            </div>
          </li>
          <li>
            <div class="step-body">
              <h4>Claude writes the code</h4>
              <p>
                Once approved, <code>ai.code</code> creates a branch, implements
                the changes, runs tests, and commits.
              </p>
            </div>
          </li>
          <li>
            <div class="step-body">
              <h4>State machine advances</h4>
              <p>
                The workflow engine opens a PR, waits for CI, handles review
                feedback, and merges — automatically, according to your rules.
              </p>
            </div>
          </li>
        </ol>

        <!-- Installation -->
        <h2 id="install">Installation</h2>
        <h3>Homebrew</h3>
        <div class="install-block">
          <span class="prompt-char">$</span>
          <code>brew install zhubert/tap/erg</code>
          <button
            class="copy-btn"
            onclick="copyCmd(this, 'brew install zhubert/tap/erg')"
          >
            copy
          </button>
        </div>

        <h3>Build from source</h3>
        <div class="install-block">
          <span class="prompt-char">$</span>
          <code>go build -o erg .</code>
          <button class="copy-btn" onclick="copyCmd(this, 'go build -o erg .')">
            copy
          </button>
        </div>

        <h3 id="quickstart">Quick start</h3>
        <p>
          Run <code>erg setup</code> inside your repo. It will walk you through
          choosing an issue provider (GitHub, Asana, or Linear), configuring
          credentials, and scaffolding a workflow — then start the daemon.
        </p>
        <div class="install-block">
          <span class="prompt-char">$</span>
          <code>erg setup</code>
          <button class="copy-btn" onclick="copyCmd(this, 'erg setup')">
            copy
          </button>
        </div>

        <!-- Workflow configuration -->
        <h2 id="workflow">Workflow configuration</h2>
        <p>
          A workflow is a directed flowchart that routes each issue from the
          first commit to a merged PR. You define <em>states</em> (nodes), the
          actions or events that drive each state, and the transitions between
          them. Run <code>erg workflow init</code> inside your repo to scaffold
          a starting point, or omit the file entirely to use the built-in
          defaults.
        </p>
        <p>
          The <code>settings</code> block controls daemon-level behaviour:
          concurrency limits, branch naming, merge strategy, and session
          constraints. The <code>source</code> block selects the issue provider
          and filter. The <code>states</code> block is the flowchart itself.
        </p>

        <h3>Pipeline overview</h3>
        <p
          style="
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
          "
        >
          The recommended workflow begins with a planning step — Claude posts an
          implementation plan for human approval before writing any code.
        </p>
        <div class="state-flow">
          <div class="sf-step">
            <div class="sf-node">
              <div class="sf-box sf-task">planning</div>
              <span class="sf-type">ai.plan</span>
            </div>
            <span class="sf-arrow">&rarr;</span>
          </div>
          <div class="sf-step">
            <div class="sf-node">
              <div class="sf-box sf-wait">await_plan</div>
              <span class="sf-type">plan.user_replied</span>
            </div>
            <span class="sf-arrow">&rarr;</span>
          </div>
          <div class="sf-step">
            <div class="sf-node">
              <div class="sf-box sf-task">coding</div>
              <span class="sf-type">ai.code</span>
            </div>
            <span class="sf-arrow">&rarr;</span>
          </div>
          <div class="sf-step">
            <div class="sf-node">
              <div class="sf-box sf-task">open_pr</div>
              <span class="sf-type">github.create_pr</span>
            </div>
            <span class="sf-arrow">&rarr;</span>
          </div>
          <div class="sf-step">
            <div class="sf-node">
              <div class="sf-box sf-wait">await_merge</div>
              <span class="sf-type">pr.mergeable</span>
            </div>
            <span class="sf-arrow">&rarr;</span>
          </div>
          <div class="sf-node">
            <div class="sf-box sf-done">done</div>
            <span class="sf-type">succeed</span>
          </div>
        </div>
        <p class="state-note">
          <code>plan.user_replied</code> loops back for re-planning on feedback
          &middot; <code>retry</code> with exponential backoff &middot;
          <code>timeout</code> enforced on wait states
        </p>

        <h3>Example config</h3>
        <div class="code-block">
          <div class="code-header">
            <span class="code-filename">.erg/workflow.yaml</span>
          </div>
          <pre><span class="ck">source:</span>
  <span class="ck">provider:</span> <span class="cv">github</span>            <span class="cc"># github | asana | linear</span>
  <span class="ck">filter:</span>
    <span class="ck">label:</span> <span class="cv">queued</span>              <span class="cc"># GitHub/Linear: issue label; Asana: tag name (optional when section is set)</span>
    <span class="ck">section:</span> <span class="cv">Todo</span>             <span class="cc"># Asana only: poll tasks in this board section instead of by tag</span>

<span class="ck">states:</span>
  <span class="ck">coding:</span>
    <span class="ck">type:</span> <span class="cs">task</span>
    <span class="ck">action:</span> <span class="ca">ai.code</span>
    <span class="ck">params:</span>
      <span class="ck">max_turns:</span> <span class="cv">50</span>
      <span class="ck">max_duration:</span> <span class="cv">30m</span>
      <span class="ck">system_prompt:</span> <span class="cv">file:.erg/prompt.md</span>
    <span class="ck">before:</span>                        <span class="cc"># runs before step; failure blocks</span>
      <span class="cv">- run: "make deps"</span>
    <span class="ck">after:</span>                         <span class="cc"># runs after; fire-and-forget</span>
      <span class="cv">- run: "make lint"</span>
    <span class="ck">retry:</span>                         <span class="cc"># retry with exponential backoff</span>
      - <span class="ck">max_attempts:</span> <span class="cv">3</span>
        <span class="ck">interval:</span> <span class="cv">30s</span>
        <span class="ck">backoff_rate:</span> <span class="cv">2.0</span>
    <span class="ck">next:</span> <span class="cv">open_pr</span>
    <span class="ck">error:</span> <span class="cv">failed</span>

  <span class="ck">await_review:</span>
    <span class="ck">type:</span> <span class="cs">wait</span>
    <span class="ck">event:</span> <span class="ca">pr.reviewed</span>
    <span class="ck">timeout:</span> <span class="cv">48h</span>                  <span class="cc"># enforced at runtime</span>
    <span class="ck">timeout_next:</span> <span class="cv">nudge_reviewers</span>  <span class="cc"># dedicated timeout edge</span>
    <span class="ck">params:</span>
      <span class="ck">auto_address:</span> <span class="cv">true</span>
      <span class="ck">max_feedback_rounds:</span> <span class="cv">3</span>

  <span class="ck">merge:</span>
    <span class="ck">type:</span> <span class="cs">task</span>
    <span class="ck">action:</span> <span class="ca">github.merge</span>
    <span class="ck">params:</span>
      <span class="ck">method:</span> <span class="cv">squash</span>            <span class="cc"># rebase | squash | merge</span></pre>
        </div>

        <h3 id="source-filter">source.filter keys</h3>
        <p>
          The <code>filter</code> block under <code>source</code> controls which
          issues or tasks erg picks up. Available keys depend on the provider.
        </p>
        <table class="cli-table">
          <thead>
            <tr>
              <th>Key</th>
              <th>Provider</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>label</code></td>
              <td>GitHub, Asana, Linear</td>
              <td>
                GitHub and Linear: issue label to poll. Asana: tag name to
                filter by. Optional for Asana when <code>section</code> is set —
                use it to narrow within a section if needed.
              </td>
            </tr>
            <tr>
              <td><code>project</code></td>
              <td>Asana</td>
              <td>
                Asana project GID. Required for all Asana workflows. Found in
                the project URL:
                <code>app.asana.com/0/<strong>{gid}</strong>/list</code>.
              </td>
            </tr>
            <tr>
              <td><code>section</code></td>
              <td>Asana</td>
              <td>
                Board section name to poll. When set, erg fetches tasks from
                that specific section rather than the whole project, enabling
                kanban-style workflows where section position — not tags —
                drives the lifecycle. Matched case-insensitively. If
                <code>label</code> is also set, it is applied as an additional
                tag filter on top of the section results.
              </td>
            </tr>
            <tr>
              <td><code>team</code></td>
              <td>Linear</td>
              <td>Linear team ID. Required for Linear workflows.</td>
            </tr>
          </tbody>
        </table>

        <!-- State types -->
        <h3 id="states">State types</h3>
        <p>
          Each state in the workflow has a type that determines its behavior.
        </p>
        <table class="cli-table">
          <thead>
            <tr>
              <th>Type</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>task</code></td>
              <td>
                Execute an action (e.g. <code>ai.code</code>,
                <code>github.merge</code>)
              </td>
            </tr>
            <tr>
              <td><code>wait</code></td>
              <td>
                Poll for an event with an enforced timeout (e.g.
                <code>pr.reviewed</code>, <code>ci.complete</code>)
              </td>
            </tr>
            <tr>
              <td><code>choice</code></td>
              <td>
                Evaluate rules against step data for conditional branching
              </td>
            </tr>
            <tr>
              <td><code>pass</code></td>
              <td>Inject data for downstream states to read</td>
            </tr>
            <tr>
              <td><code>succeed</code></td>
              <td>Terminal state &mdash; marks the work item as complete</td>
            </tr>
            <tr>
              <td><code>fail</code></td>
              <td>Terminal state &mdash; marks the work item as failed</td>
            </tr>
          </tbody>
        </table>

        <h3 id="state-task">task</h3>
        <p>
          A <code>task</code> state executes a registered action and then
          transitions to <code>next</code> on success or <code>error</code> on
          failure. Every action that calls an external API (GitHub, Asana,
          Linear, git remotes) should define a <code>retry</code> block. Network
          failures are transient — without retry, a momentary outage permanently
          fails the work item.
        </p>
        <div class="code-block">
          <div class="code-header">
            <span class="code-filename">retry example</span>
          </div>
          <pre><span class="ck">open_pr:</span>
  <span class="ck">type:</span> <span class="cs">task</span>
  <span class="ck">action:</span> <span class="ca">github.create_pr</span>
  <span class="ck">retry:</span>
    - <span class="ck">max_attempts:</span> <span class="cv">3</span>
      <span class="ck">interval:</span> <span class="cv">15s</span>
      <span class="ck">backoff_rate:</span> <span class="cv">2.0</span>   <span class="cc"># waits 15s, 30s, 60s</span>
  <span class="ck">next:</span> <span class="cv">await_review</span>
  <span class="ck">error:</span> <span class="cv">failed</span></pre>
        </div>
        <p>
          Use <code>catch</code> to route specific error types to recovery
          states instead of the generic <code>error</code> edge. Use
          <code>before</code> hooks to run setup scripts (blocking) and
          <code>after</code> hooks for teardown (fire-and-forget).
        </p>

        <h3 id="state-wait">wait</h3>
        <p>
          A <code>wait</code> state polls for an external event on each daemon
          tick. It does not advance until the event fires. Always set a
          <code>timeout</code> to prevent indefinite waits &mdash; use
          <code>timeout_next</code> to route the timeout to a dedicated state
          (e.g. post a comment) rather than the generic <code>error</code> edge.
        </p>
        <div class="code-block">
          <div class="code-header">
            <span class="code-filename">wait example</span>
          </div>
          <pre><span class="ck">await_review:</span>
  <span class="ck">type:</span> <span class="cs">wait</span>
  <span class="ck">event:</span> <span class="ca">pr.reviewed</span>
  <span class="ck">timeout:</span> <span class="cv">72h</span>
  <span class="ck">timeout_next:</span> <span class="cv">nudge_reviewers</span>
  <span class="ck">params:</span>
    <span class="ck">auto_address:</span> <span class="cv">true</span>          <span class="cc"># Claude addresses feedback while waiting</span>
    <span class="ck">max_feedback_rounds:</span> <span class="cv">3</span>
  <span class="ck">next:</span> <span class="cv">merge</span>
  <span class="ck">error:</span> <span class="cv">failed</span></pre>
        </div>
        <p>
          The <code>pr.mergeable</code> event is a shorthand that combines
          <code>pr.reviewed</code> and <code>ci.complete</code> into a single
          wait state. Use it for simple pipelines where you want both conditions
          satisfied before proceeding.
        </p>

        <h3 id="state-choice">choice</h3>
        <p>
          A <code>choice</code> state reads values from the accumulated step
          data and branches to different states based on rules. Each rule
          specifies a <code>variable</code>, an <code>equals</code> value, and a
          <code>next</code> state. The <code>default</code> route fires when no
          rule matches.
        </p>
        <div class="code-block">
          <div class="code-header">
            <span class="code-filename">choice example</span>
          </div>
          <pre><span class="ck">check_ci:</span>
  <span class="ck">type:</span> <span class="cs">choice</span>
  <span class="ck">choices:</span>
    - <span class="ck">variable:</span> <span class="cv">ci_passed</span>
      <span class="ck">equals:</span> <span class="cv">true</span>
      <span class="ck">next:</span> <span class="cv">request_reviewer</span>
    - <span class="ck">variable:</span> <span class="cv">ci_failed</span>
      <span class="ck">equals:</span> <span class="cv">true</span>
      <span class="ck">next:</span> <span class="cv">fix_ci</span>
  <span class="ck">default:</span> <span class="cv">failed</span></pre>
        </div>
        <p>
          Choice states are the branching points of your flowchart. Combine them
          with <code>pass</code> states to make decisions on injected
          configuration flags, or with CI/review wait states to route on
          outcomes.
        </p>

        <h3 id="state-pass">pass</h3>
        <p>
          A <code>pass</code> state injects static data into the workflow
          context and immediately transitions to <code>next</code>. Use it at
          the start of a workflow to set configuration flags that downstream
          <code>choice</code> states can inspect.
        </p>
        <div class="code-block">
          <div class="code-header">
            <span class="code-filename">pass example</span>
          </div>
          <pre><span class="ck">configure:</span>
  <span class="ck">type:</span> <span class="cs">pass</span>
  <span class="ck">data:</span>
    <span class="ck">close_issue_on_merge:</span> <span class="cv">true</span>
    <span class="ck">max_ci_fix_rounds:</span> <span class="cv">3</span>
  <span class="ck">next:</span> <span class="cv">coding</span></pre>
        </div>

        <!-- Error handling -->
        <h3 id="error-handling">Error handling</h3>
        <div class="info-grid">
          <div class="info-card">
            <h4>retry</h4>
            <p>
              Task states support <code>retry</code> with configurable
              <code>max_attempts</code>, <code>interval</code>, and exponential
              <code>backoff_rate</code>.
            </p>
          </div>
          <div class="info-card">
            <h4>catch</h4>
            <p>
              Route specific errors to recovery states with
              <code>catch</code> blocks. Match by error type or message pattern.
            </p>
          </div>
          <div class="info-card">
            <h4>timeout</h4>
            <p>
              Wait states enforce <code>timeout</code> durations at runtime.
              <code>timeout_next</code> provides a dedicated transition edge.
            </p>
          </div>
          <div class="info-card">
            <h4>error state</h4>
            <p>
              Every task state can define an <code>error</code> transition for
              unrecoverable failures. Defaults to the
              <code>failed</code> terminal state.
            </p>
          </div>
        </div>

        <!-- Hooks -->
        <h3 id="hooks">Hooks</h3>
        <p>
          <code>before</code> hooks run before step execution &mdash; if they
          fail, the step is blocked. <code>after</code> hooks run after
          completion and are fire-and-forget.
        </p>
        <p>
          Hooks receive environment variables including
          <code>$ERG_BRANCH</code>, <code>$ERG_PR_URL</code>,
          <code>$ERG_ISSUE_URL</code>, and more.
        </p>

        <!-- CLI reference -->
        <h2 id="cli">CLI commands</h2>
        <p>
          The most commonly used commands are listed below. Run any command with
          <code>-h</code> to see all available flags.
        </p>
        <table class="cli-table">
          <thead>
            <tr>
              <th>Command</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>erg start --repo owner/repo</code></td>
              <td>Start daemon in the background (prints PID and exits)</td>
            </tr>
            <tr>
              <td><code>erg start -f --repo owner/repo</code></td>
              <td>Start in foreground with live status display</td>
            </tr>
            <tr>
              <td><code>erg stop</code></td>
              <td>Gracefully shut down the running daemon</td>
            </tr>
            <tr>
              <td><code>erg status</code></td>
              <td>Show daemon status (PID, uptime, active sessions)</td>
            </tr>
            <tr>
              <td><code>erg status --tail</code></td>
              <td>
                Live split-screen log view — one column per active session
              </td>
            </tr>
            <tr>
              <td><code>erg workflow init</code></td>
              <td>
                Scaffold a <code>.erg/workflow.yaml</code> in the current repo
              </td>
            </tr>
            <tr>
              <td><code>erg workflow validate</code></td>
              <td>Validate the workflow config for errors</td>
            </tr>
            <tr>
              <td><code>erg workflow visualize</code></td>
              <td>Emit a Mermaid diagram of the current workflow</td>
            </tr>
            <tr>
              <td><code>erg clean</code></td>
              <td>Clear daemon state and lock files</td>
            </tr>
          </tbody>
        </table>

        <!-- Action reference -->
        <h2 id="actions">Action reference</h2>
        <p>
          Actions are used in <code>task</code> states via the
          <code>action:</code> key. Each action accepts typed
          <code>params</code> and may produce output data that downstream
          <code>choice</code> states can inspect.
        </p>

        <h3 id="actions-ai">AI actions</h3>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">ai.code</span>
            <span class="badge badge-async">async</span>
          </div>
          <p class="action-desc">
            Starts an autonomous Claude Code session that reads the issue,
            writes code, runs tests, and commits changes locally. The daemon
            waits for the session to complete before advancing.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>max_turns</td>
                  <td>int</td>
                  <td>50</td>
                  <td>Maximum number of Claude turns per session.</td>
                </tr>
                <tr>
                  <td>max_duration</td>
                  <td>duration</td>
                  <td>30m</td>
                  <td>
                    Hard time limit for the session, e.g. <code>20m</code>,
                    <code>2h</code>.
                  </td>
                </tr>
                <tr>
                  <td>containerized</td>
                  <td>bool</td>
                  <td>true</td>
                  <td>Run Claude inside a Docker container sandbox.</td>
                </tr>
                <tr>
                  <td>system_prompt</td>
                  <td>string</td>
                  <td><em>built-in</em></td>
                  <td>
                    Inline prompt or <code>file:.erg/prompt.md</code> to load
                    from the repo. Overrides the default coding prompt.
                  </td>
                </tr>
                <tr>
                  <td>format_command</td>
                  <td>string</td>
                  <td><em>none</em></td>
                  <td>
                    Shell command to run as a formatter after coding completes
                    (e.g. <code>go fmt ./...</code>). Claude is also instructed
                    to run it before each commit. Omit to skip auto-formatting.
                  </td>
                </tr>
                <tr>
                  <td>format_message</td>
                  <td>string</td>
                  <td>Apply auto-formatting</td>
                  <td>
                    Commit message used when the daemon commits the post-coding
                    format pass. Only used when
                    <code>format_command</code> is set.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">
              None. Session completion is signalled internally; the daemon
              advances the state machine when the worker exits.
            </p>
          </div>
          <div class="param-section">
            <div class="param-section-title">Notes</div>
            <ul
              style="
                margin: 0.35rem 0 0;
                padding-left: 1.25rem;
                font-size: 0.82rem;
                color: var(--text-muted);
              "
            >
              <li>
                If the branch already has an open PR, coding is skipped and the
                workflow advances to <code>github.create_pr</code>, which
                detects the existing PR.
              </li>
              <li>
                If the branch was already merged, the issue is closed and the
                workflow jumps to <code>done</code>.
              </li>
            </ul>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">ai.fix_ci</span>
            <span class="badge badge-async">async</span>
          </div>
          <p class="action-desc">
            Resumes the existing Claude session to fix failing CI. Fetches
            failure logs from the most recent GitHub Actions run and passes them
            to Claude as context.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>max_ci_fix_rounds</td>
                  <td>int</td>
                  <td>3</td>
                  <td>
                    Maximum number of CI fix attempts before returning an error.
                  </td>
                </tr>
                <tr>
                  <td>system_prompt</td>
                  <td>string</td>
                  <td><em>built-in</em></td>
                  <td>Custom system prompt for the fix session.</td>
                </tr>
                <tr>
                  <td>format_command</td>
                  <td>string</td>
                  <td><em>inherited</em></td>
                  <td>
                    Shell command to run as a formatter after each CI fix round
                    (e.g. <code>go fmt ./...</code>). Overrides the value
                    inherited from the <code>ai.code</code> step. Omit to keep
                    the inherited formatter or skip formatting.
                  </td>
                </tr>
                <tr>
                  <td>format_message</td>
                  <td>string</td>
                  <td>Apply auto-formatting</td>
                  <td>
                    Commit message used when the daemon commits the
                    post-fix-round format pass. Only used when
                    <code>format_command</code> is set (directly or inherited).
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Type</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>ci_fix_rounds</td>
                  <td>int</td>
                  <td>
                    Incremented on each attempt. Inspect in
                    <code>choice</code> states to check round count.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">ai.address_review</span>
            <span class="badge badge-async">async</span>
          </div>
          <p class="action-desc">
            Fetches PR review comments and resumes the coding session to address
            them. Daemon-managed transcript comments are filtered out so Claude
            only sees human feedback. Increments <code>review_rounds</code> on
            each invocation; returns an error when the max is reached.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>max_review_rounds</td>
                  <td>int</td>
                  <td>3</td>
                  <td>
                    Maximum number of review-address attempts before returning
                    an error.
                  </td>
                </tr>
                <tr>
                  <td>system_prompt</td>
                  <td>string</td>
                  <td><em>built-in</em></td>
                  <td>Custom system prompt for the review-address session.</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Type</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>review_rounds</td>
                  <td>int</td>
                  <td>
                    Incremented on each attempt. Inspect in
                    <code>choice</code> states to check round count.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">ai.write_pr_description</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Generates a rich PR description from the branch diff using Claude
            and updates the open PR body. Useful after coding to produce a
            concise, human-readable summary before requesting review.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <p class="param-none">None.</p>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">ai.resolve_conflicts</span>
            <span class="badge badge-async">async</span>
          </div>
          <p class="action-desc">
            Merges the base branch into the feature branch (leaving conflict
            markers in place), then starts a Claude session to resolve the
            conflicts. Claude reads each conflicted file, resolves the markers,
            stages the files, and commits the merge.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>max_conflict_rounds</td>
                  <td>int</td>
                  <td>3</td>
                  <td>
                    Maximum number of conflict resolution attempts before
                    returning an error.
                  </td>
                </tr>
                <tr>
                  <td>system_prompt</td>
                  <td>string</td>
                  <td><em>built-in</em></td>
                  <td>Custom system prompt for the resolution session.</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Type</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>conflict_rounds</td>
                  <td>int</td>
                  <td>
                    Incremented on each attempt. Inspect in
                    <code>choice</code> states to check round count.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">ai.plan</span>
            <span class="badge badge-async">async</span>
          </div>
          <p class="action-desc">
            Starts a read-only planning session where Claude analyzes the issue
            and codebase, then posts a structured implementation plan as an
            issue comment. No new branch or worktree is created — Claude reads
            from the main repo directory. Useful as a first step before
            <code>ai.code</code> to get human sign-off on the approach.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>system_prompt</td>
                  <td>string</td>
                  <td><em>built-in</em></td>
                  <td>
                    Inline prompt or <code>file:.erg/plan_prompt.md</code> to
                    load from the repo. Overrides the default planning prompt.
                  </td>
                </tr>
                <tr>
                  <td>max_turns</td>
                  <td>int</td>
                  <td><em>unlimited</em></td>
                  <td>
                    Maximum number of Claude turns for the planning session.
                  </td>
                </tr>
                <tr>
                  <td>max_duration</td>
                  <td>duration</td>
                  <td><em>none</em></td>
                  <td>
                    Hard time limit for the session, e.g. <code>20m</code>,
                    <code>2h</code>.
                  </td>
                </tr>
                <tr>
                  <td>containerized</td>
                  <td>bool</td>
                  <td>true</td>
                  <td>Run Claude inside a Docker container sandbox.</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">
              None. The plan is posted as an issue comment by Claude during the
              session. The daemon advances the state machine when the worker
              exits.
            </p>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">ai.review</span>
            <span class="badge badge-async">async</span>
          </div>
          <p class="action-desc">
            Runs a Claude session to self-review the branch diff before pushing,
            acting as a quality gate. Claude examines the diff, checks for
            correctness, test coverage, security issues, and code quality, then
            reports via the <code>submit_review</code> MCP tool. If the review
            fails (<code>passed=false</code>), the step returns an error and the
            workflow follows the error edge.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>max_ai_review_rounds</td>
                  <td>int</td>
                  <td>1</td>
                  <td>
                    Maximum number of review attempts before returning an error.
                  </td>
                </tr>
                <tr>
                  <td>system_prompt</td>
                  <td>string</td>
                  <td><em>built-in</em></td>
                  <td>Custom system prompt for the review session.</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Type</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>review_passed</td>
                  <td>bool</td>
                  <td>
                    <code>true</code> if the review passed,
                    <code>false</code> if it was blocked. Inspect in
                    <code>choice</code> states to branch on review outcome.
                  </td>
                </tr>
                <tr>
                  <td>ai_review_summary</td>
                  <td>string</td>
                  <td>One-sentence summary of the review findings.</td>
                </tr>
                <tr>
                  <td>ai_review_rounds</td>
                  <td>int</td>
                  <td>
                    Incremented on each attempt. Inspect in
                    <code>choice</code> states to check round count.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <h3 id="actions-github">GitHub actions</h3>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">github.create_pr</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Opens a pull request from the working branch to the base branch.
            Detects and reuses an existing PR if one was already opened in a
            previous attempt.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>link_issue</td>
                  <td>bool</td>
                  <td>true</td>
                  <td>
                    Add a closing reference to the source issue in the PR body
                    (e.g. <code>Closes #42</code>).
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Type</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>pr_url</td>
                  <td>string</td>
                  <td>URL of the created (or existing) pull request.</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Notes</div>
            <ul
              style="
                margin: 0.35rem 0 0;
                padding-left: 1.25rem;
                font-size: 0.82rem;
                color: var(--text-muted);
              "
            >
              <li>
                If the coding session made no commits, the issue is closed
                automatically and the workflow skips to <code>done</code>.
              </li>
            </ul>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">github.create_draft_pr</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Opens a draft pull request from the working branch. Equivalent to
            <code>github.create_pr</code> with <code>draft: true</code>. Use
            when you want the PR visible for early feedback but not yet ready
            for formal review.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>link_issue</td>
                  <td>bool</td>
                  <td>true</td>
                  <td>
                    Add a closing reference to the source issue in the PR body
                    (e.g. <code>Closes #42</code>).
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Type</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>pr_url</td>
                  <td>string</td>
                  <td>URL of the created draft pull request.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">github.push</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Pushes committed changes to the remote branch. Typically used after
            Claude addresses review feedback.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <p class="param-none">None.</p>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">github.merge</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Merges the pull request into the base branch using the configured
            strategy.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>method</td>
                  <td>string</td>
                  <td>rebase</td>
                  <td>
                    Merge strategy: <code>rebase</code>, <code>squash</code>, or
                    <code>merge</code>.
                  </td>
                </tr>
                <tr>
                  <td>cleanup</td>
                  <td>bool</td>
                  <td>false</td>
                  <td>
                    Delete the worktree and branch after a successful merge.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">github.comment_issue</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Posts a comment on the original issue associated with the work item.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>body</td>
                  <td>string</td>
                  <td><em>required</em></td>
                  <td>
                    Comment text. Prefix with <code>file:</code> to load content
                    from a repo path, e.g.
                    <code>file:.erg/comments/msg.md</code>.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">github.comment_pr</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Posts a comment on the pull request for the work item.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>body</td>
                  <td>string</td>
                  <td><em>required</em></td>
                  <td>
                    Comment text. Prefix with <code>file:</code> to load content
                    from a repo path, e.g.
                    <code>file:.erg/comments/msg.md</code>.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">github.add_label</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">Adds a label to the source issue.</p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>label</td>
                  <td>string</td>
                  <td><em>required</em></td>
                  <td>Label name to add.</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">github.remove_label</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">Removes a label from the source issue.</p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>label</td>
                  <td>string</td>
                  <td><em>required</em></td>
                  <td>Label name to remove.</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">github.close_issue</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">Closes the source issue.</p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <p class="param-none">None.</p>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">github.request_review</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Requests a review from a specific GitHub user on the pull request.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>reviewer</td>
                  <td>string</td>
                  <td><em>required</em></td>
                  <td>GitHub username to request a review from.</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">github.assign_pr</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Assigns the pull request to a specific GitHub user. Useful for
            routing work to the right person after coding completes.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>assignee</td>
                  <td>string</td>
                  <td><em>required</em></td>
                  <td>GitHub username to assign the PR to.</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">github.create_release</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Creates a GitHub release for the repository. Typically used in
            post-merge workflows to publish a tagged release after a PR lands.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>tag</td>
                  <td>string</td>
                  <td><em>required</em></td>
                  <td>Git tag for the release, e.g. <code>v1.2.0</code>.</td>
                </tr>
                <tr>
                  <td>title</td>
                  <td>string</td>
                  <td><em>same as tag</em></td>
                  <td>Release title displayed on GitHub.</td>
                </tr>
                <tr>
                  <td>notes</td>
                  <td>string</td>
                  <td><em>empty</em></td>
                  <td>Release body / change notes.</td>
                </tr>
                <tr>
                  <td>draft</td>
                  <td>bool</td>
                  <td>false</td>
                  <td>Create the release as a draft (not publicly visible).</td>
                </tr>
                <tr>
                  <td>prerelease</td>
                  <td>bool</td>
                  <td>false</td>
                  <td>Mark the release as a pre-release.</td>
                </tr>
                <tr>
                  <td>target</td>
                  <td>string</td>
                  <td><em>default branch</em></td>
                  <td>Target branch or commit SHA for the release tag.</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Type</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>release_url</td>
                  <td>string</td>
                  <td>URL of the created GitHub release.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <h3 id="actions-asana">Asana actions</h3>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">asana.comment</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Posts a comment on the Asana task associated with the work item.
            Requires the <code>ASANA_PAT</code> environment variable to be set
            and an Asana provider registered for the repository.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>body</td>
                  <td>string</td>
                  <td><em>required</em></td>
                  <td>
                    Comment text. Prefix with <code>file:</code> to load content
                    from a repo path, e.g.
                    <code>file:.erg/comments/msg.md</code>.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">asana.move_to_section</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Moves the Asana task to a named section within its configured
            project board. Use this to reflect workflow progress on the board
            (e.g., move a card to &ldquo;In Review&rdquo; after opening a PR).
            Requires the <code>ASANA_PAT</code> environment variable to be set
            and an Asana provider registered for the repository.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>section</td>
                  <td>string</td>
                  <td><em>required</em></td>
                  <td>
                    Name of the board section to move the task into. Matched
                    case-insensitively against the project's sections.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <h3 id="actions-linear">Linear actions</h3>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">linear.comment</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Posts a comment on the Linear issue associated with the work item.
            Requires the <code>LINEAR_API_KEY</code> environment variable to be
            set and a Linear provider registered for the repository.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>body</td>
                  <td>string</td>
                  <td><em>required</em></td>
                  <td>
                    Comment text. Prefix with <code>file:</code> to load content
                    from a repo path, e.g.
                    <code>file:.erg/comments/msg.md</code>.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">linear.move_to_state</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Moves the Linear issue to a named workflow state (e.g.,
            &ldquo;In Progress&rdquo;, &ldquo;Done&rdquo;). Use this to reflect
            workflow progress in Linear as work advances through the pipeline.
            Requires the <code>LINEAR_API_KEY</code> environment variable to be
            set and a Linear provider registered for the repository.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>state</td>
                  <td>string</td>
                  <td><em>required</em></td>
                  <td>
                    Name of the workflow state to move the issue into. Matched
                    case-insensitively against the team's configured states.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <h3 id="actions-git">Git actions</h3>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">git.format</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Runs a formatter command in the session worktree, stages all changes
            with <code>git add -A</code>, and commits them. Silently succeeds if
            the formatter produces no changes.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>command</td>
                  <td>string</td>
                  <td><em>required</em></td>
                  <td>
                    Shell command to run, e.g. <code>gofmt -w .</code> or
                    <code>prettier --write .</code>.
                  </td>
                </tr>
                <tr>
                  <td>message</td>
                  <td>string</td>
                  <td>Apply auto-formatting</td>
                  <td>
                    Commit message used when the formatter produces changes.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">git.rebase</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Rebases the feature branch onto the latest base branch and
            force-pushes. This is a mechanical rebase — if real file-level
            conflicts exist, the rebase is aborted and an error is returned.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>max_rebase_rounds</td>
                  <td>int</td>
                  <td>3</td>
                  <td>
                    Maximum number of rebase attempts before returning an error.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Type</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>rebase_rounds</td>
                  <td>int</td>
                  <td>Incremented on each attempt.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">git.squash</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Squashes all commits on the feature branch since it diverged from
            the base branch into a single commit. Useful before opening a PR
            when you want a clean, single-commit history.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>message</td>
                  <td>string</td>
                  <td><em>auto-generated</em></td>
                  <td>
                    Commit message for the squashed commit. Defaults to a
                    summary generated from the original commit messages.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">git.validate_diff</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Runs static validation checks on the branch diff before pushing or
            opening a PR. All params are optional; with no params the check
            always passes. Returns an error listing all violations found.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>max_diff_lines</td>
                  <td>int</td>
                  <td>0 (disabled)</td>
                  <td>
                    Fail if total added + deleted lines exceed this value.
                  </td>
                </tr>
                <tr>
                  <td>forbidden_patterns</td>
                  <td>[]string</td>
                  <td><em>none</em></td>
                  <td>
                    Fail if any changed file matches one of these glob patterns,
                    e.g. <code>[".env", "*.pem"]</code>.
                  </td>
                </tr>
                <tr>
                  <td>require_tests</td>
                  <td>bool</td>
                  <td>false</td>
                  <td>
                    Fail if source files were modified but no test files appear
                    in the diff.
                  </td>
                </tr>
                <tr>
                  <td>source_patterns</td>
                  <td>[]string</td>
                  <td><em>common extensions</em></td>
                  <td>
                    Glob patterns identifying source files for the
                    <code>require_tests</code> check. Defaults to
                    <code>*.go</code>, <code>*.py</code>, <code>*.js</code>,
                    etc.
                  </td>
                </tr>
                <tr>
                  <td>test_patterns</td>
                  <td>[]string</td>
                  <td><em>common patterns</em></td>
                  <td>
                    Glob patterns identifying test files. Defaults to
                    <code>*_test.go</code>, <code>test_*.py</code>,
                    <code>*.test.js</code>, etc.
                  </td>
                </tr>
                <tr>
                  <td>max_lock_file_lines</td>
                  <td>int</td>
                  <td>0 (disabled)</td>
                  <td>
                    Fail if any single lock file has more than this many lines
                    changed.
                  </td>
                </tr>
                <tr>
                  <td>lock_file_patterns</td>
                  <td>[]string</td>
                  <td><em>common lock files</em></td>
                  <td>
                    Glob patterns for lock files. Defaults to
                    <code>go.sum</code>, <code>package-lock.json</code>,
                    <code>yarn.lock</code>, etc.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Type</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>violations</td>
                  <td>[]string</td>
                  <td>List of violation messages when checks fail.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">git.cherry_pick</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Cherry-picks one or more commits onto a target branch. Designed for
            backport workflows where merged changes need to be applied to a
            release or maintenance branch.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>commits</td>
                  <td>[]string | string</td>
                  <td><em>required</em></td>
                  <td>
                    List of commit SHAs to cherry-pick. Accepts a YAML sequence
                    or a space-separated string.
                  </td>
                </tr>
                <tr>
                  <td>target_branch</td>
                  <td>string</td>
                  <td><em>required</em></td>
                  <td>Branch to cherry-pick the commits onto.</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <h3 id="actions-slack">Slack actions</h3>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">slack.notify</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Posts a notification to a Slack channel via an incoming webhook. The
            message supports Go <code>text/template</code> syntax with work item
            variables. The webhook URL supports <code>$ENV_VAR</code> expansion
            so secrets stay out of config files.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>webhook_url</td>
                  <td>string</td>
                  <td><em>required</em></td>
                  <td>
                    Slack incoming webhook URL. Supports
                    <code>$ENV_VAR</code> substitution, e.g.
                    <code>$SLACK_WEBHOOK_URL</code>.
                  </td>
                </tr>
                <tr>
                  <td>message</td>
                  <td>string</td>
                  <td><em>required</em></td>
                  <td>
                    Message text. Go <code>text/template</code> variables:
                    <code>{{.Title}}</code>, <code>{{.IssueID}}</code>,
                    <code>{{.IssueURL}}</code>, <code>{{.PRURL}}</code>,
                    <code>{{.Branch}}</code>, <code>{{.Status}}</code>.
                  </td>
                </tr>
                <tr>
                  <td>username</td>
                  <td>string</td>
                  <td>erg</td>
                  <td>Display name shown in Slack.</td>
                </tr>
                <tr>
                  <td>icon_emoji</td>
                  <td>string</td>
                  <td>:robot_face:</td>
                  <td>Emoji icon for the Slack message.</td>
                </tr>
                <tr>
                  <td>channel</td>
                  <td>string</td>
                  <td><em>webhook default</em></td>
                  <td>
                    Override the channel configured in the webhook, e.g.
                    <code>#alerts</code>.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
          <div class="param-section">
            <div class="param-section-title">Setup</div>
            <p class="param-none">
              Slack uses <strong>Incoming Webhooks</strong> for authentication —
              there is no separate API token. To get a webhook URL:
            </p>
            <ol
              style="
                margin: 0.35rem 0 0;
                padding-left: 1.25rem;
                font-size: 0.82rem;
                color: var(--text-muted);
              "
            >
              <li>
                Go to
                <a
                  href="https://api.slack.com/apps"
                  target="_blank"
                  rel="noopener"
                  style="color: var(--cyan)"
                  >api.slack.com/apps</a
                >
                and create a new app (or open an existing one).
              </li>
              <li>
                Under <strong>Features</strong>, click
                <strong>Incoming Webhooks</strong> and toggle it on.
              </li>
              <li>
                Click <strong>Add New Webhook to Workspace</strong>, choose a
                channel, and authorise.
              </li>
              <li>
                Copy the generated URL (e.g.
                <code>https://hooks.slack.com/services/T.../B.../...</code>).
              </li>
              <li>
                Set it as an environment variable on the host running erg:<br />
                <code
                  >export
                  SLACK_WEBHOOK_URL=https://hooks.slack.com/services/...</code
                >
              </li>
              <li>
                Reference it in your workflow config as
                <code>webhook_url: $SLACK_WEBHOOK_URL</code>.
              </li>
            </ol>
          </div>
          <div class="param-section">
            <div class="param-section-title">Example</div>
            <div class="code-block" style="margin-top: 0.4rem">
              <div class="code-header">
                <span class="code-filename">workflow.yaml (excerpt)</span>
              </div>
              <pre>
  notify_merged:
    type: task
    action: slack.notify
    params:
      webhook_url: $SLACK_WEBHOOK_URL           # set in the host environment
      message: "Merged: {{.Title}} (#{{.IssueID}})\n{{.PRURL}}"
      username: erg
      icon_emoji: ":white_check_mark:"
      channel: "#eng-deployments"              # optional — overrides webhook default
    next: done</pre
              >
            </div>
            <p
              style="
                margin: 0.6rem 0 0.25rem;
                font-size: 0.82rem;
                color: var(--text-muted);
              "
            >
              Given an issue titled <em>"Fix login redirect loop"</em> with ID
              <code>42</code> and a merged PR, the message posted to Slack would
              be:
            </p>
            <div class="code-block" style="margin-top: 0.25rem">
              <div class="code-header">
                <span class="code-filename">Slack message (rendered)</span>
              </div>
              <pre>
Merged: Fix login redirect loop (#42)
https://github.com/your-org/your-repo/pull/99</pre
              >
            </div>
          </div>
        </div>

        <h3 id="actions-webhook">Webhook actions</h3>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">webhook.post</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            POSTs a JSON body to a configurable URL. The body is a Go
            <code>text/template</code> string interpolated with work item data.
            Use for integrating with external systems &mdash; CI triggers,
            deployment pipelines, or custom notification endpoints.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>url</td>
                  <td>string</td>
                  <td><em>required</em></td>
                  <td>Destination URL for the POST request.</td>
                </tr>
                <tr>
                  <td>body</td>
                  <td>string</td>
                  <td><em>required</em></td>
                  <td>
                    JSON body template. Go <code>text/template</code> variables:
                    <code>{{.IssueID}}</code>, <code>{{.IssueTitle}}</code>,
                    <code>{{.IssueURL}}</code>, <code>{{.IssueSource}}</code>,
                    <code>{{.PRURL}}</code>, <code>{{.Branch}}</code>,
                    <code>{{.State}}</code>, <code>{{.WorkItemID}}</code>.
                  </td>
                </tr>
                <tr>
                  <td>headers</td>
                  <td>map[string]string</td>
                  <td><em>none</em></td>
                  <td>
                    Additional HTTP request headers, e.g.
                    <code>Authorization: Bearer $TOKEN</code>.
                  </td>
                </tr>
                <tr>
                  <td>timeout</td>
                  <td>duration</td>
                  <td>30s</td>
                  <td>
                    Request timeout, e.g. <code>10s</code>, <code>1m</code>.
                  </td>
                </tr>
                <tr>
                  <td>expected_status</td>
                  <td>int</td>
                  <td>200</td>
                  <td>
                    HTTP status code considered a success. Non-matching codes
                    return an error.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Type</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>response_status</td>
                  <td>int</td>
                  <td>HTTP status code returned by the server.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <h3 id="actions-workflow">Workflow actions</h3>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">workflow.retry</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Meta-action that wraps another registered action with synchronous
            retry logic. On failure it sleeps for the configured interval
            (scaled by <code>backoff_rate</code> on each subsequent attempt) and
            re-executes the inner action. Async inner actions are passed through
            unchanged on the first attempt since they cannot be retried
            synchronously.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>action</td>
                  <td>string</td>
                  <td><em>required</em></td>
                  <td>
                    Name of the inner action to execute, e.g.
                    <code>github.push</code>.
                  </td>
                </tr>
                <tr>
                  <td>max_attempts</td>
                  <td>int</td>
                  <td>3</td>
                  <td>Total number of attempts (1 = no retry).</td>
                </tr>
                <tr>
                  <td>interval</td>
                  <td>duration</td>
                  <td>0</td>
                  <td>
                    Base delay between retries, e.g. <code>10s</code>,
                    <code>1m</code>.
                  </td>
                </tr>
                <tr>
                  <td>backoff_rate</td>
                  <td>float</td>
                  <td>1.0</td>
                  <td>
                    Multiplier applied to <code>interval</code> after each
                    failed attempt. <code>1.0</code> = fixed delay;
                    <code>2.0</code> = double each time.
                  </td>
                </tr>
                <tr>
                  <td>params</td>
                  <td>map</td>
                  <td><em>none</em></td>
                  <td>Parameters forwarded to the inner action.</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">
              Returns the output data from the inner action on success.
            </p>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">workflow.wait</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Pauses workflow execution for a configurable duration. Cancels
            cleanly on daemon shutdown. Useful as a delay between polling cycles
            or before time-sensitive operations.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>duration</td>
                  <td>duration</td>
                  <td><em>required</em></td>
                  <td>
                    How long to pause, e.g. <code>30s</code>, <code>5m</code>,
                    <code>1h</code>.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <!-- Wait events reference -->
        <h2 id="events">Wait events</h2>
        <p>
          Events are used in <code>wait</code> states via the
          <code>event:</code> key. The daemon polls on each tick and advances
          the state machine when the event fires. All wait states support
          <code>timeout</code> and <code>timeout_next</code>.
        </p>

        <h3 id="events-pr">PR events</h3>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">pr.reviewed</span>
          </div>
          <p class="action-desc">
            Fires when the pull request receives a formal approval. While
            waiting, the daemon automatically resumes Claude to address new
            review comments (configurable via <code>auto_address</code>).
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>auto_address</td>
                  <td>bool</td>
                  <td>true</td>
                  <td>
                    Automatically resume Claude to address new review comments
                    while waiting for approval.
                  </td>
                </tr>
                <tr>
                  <td>max_feedback_rounds</td>
                  <td>int</td>
                  <td>3</td>
                  <td>
                    Maximum number of feedback rounds before auto-addressing
                    stops.
                  </td>
                </tr>
                <tr>
                  <td>format_command</td>
                  <td>string</td>
                  <td><em>inherited</em></td>
                  <td>
                    Shell command to run as a formatter after each review
                    feedback round (e.g. <code>go fmt ./...</code>). Overrides
                    the value inherited from the <code>ai.code</code> step. Omit
                    to keep the inherited formatter or skip formatting.
                  </td>
                </tr>
                <tr>
                  <td>format_message</td>
                  <td>string</td>
                  <td>Apply auto-formatting</td>
                  <td>
                    Commit message used when the daemon commits the
                    post-feedback format pass. Only used when
                    <code>format_command</code> is set (directly or inherited).
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Type</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>review_approved</td>
                  <td>bool</td>
                  <td>Set to <code>true</code> when a reviewer approves.</td>
                </tr>
                <tr>
                  <td>pr_merged_externally</td>
                  <td>bool</td>
                  <td>
                    Set to <code>true</code> if the PR was merged outside the
                    daemon.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">pr.mergeable</span>
          </div>
          <p class="action-desc">
            Convenience event that combines <code>pr.reviewed</code> and
            <code>ci.complete</code>. Fires only when both review approval and
            CI pass simultaneously. Useful for minimal pipelines that don't need
            separate wait states.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>require_review</td>
                  <td>bool</td>
                  <td>true</td>
                  <td>Require an approved review before firing.</td>
                </tr>
                <tr>
                  <td>require_ci</td>
                  <td>bool</td>
                  <td>true</td>
                  <td>Require CI to pass before firing.</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Type</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>review_approved</td>
                  <td>bool</td>
                  <td>True when a reviewer has approved.</td>
                </tr>
                <tr>
                  <td>ci_passed</td>
                  <td>bool</td>
                  <td>True when all CI checks pass.</td>
                </tr>
                <tr>
                  <td>ci_failed</td>
                  <td>bool</td>
                  <td>True when any CI check fails.</td>
                </tr>
                <tr>
                  <td>pr_merged_externally</td>
                  <td>bool</td>
                  <td>True if the PR was merged outside the daemon.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <h3 id="events-ci">CI events</h3>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">ci.complete</span>
          </div>
          <p class="action-desc">
            Fires when all CI checks on the PR pass. Configurable behaviour on
            CI failure lets workflows route to <code>ai.fix_ci</code> or other
            states.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>on_failure</td>
                  <td>string</td>
                  <td>retry</td>
                  <td>
                    Action when CI fails: <code>retry</code> — keep waiting
                    (default); <code>fix</code> — fire the event so the workflow
                    can route to <code>ai.fix_ci</code>; <code>abandon</code> or
                    <code>notify</code> — emit data for downstream routing
                    without advancing.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Type</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>ci_passed</td>
                  <td>bool</td>
                  <td>True when all checks pass.</td>
                </tr>
                <tr>
                  <td>ci_failed</td>
                  <td>bool</td>
                  <td>True when any check fails.</td>
                </tr>
                <tr>
                  <td>ci_action</td>
                  <td>string</td>
                  <td>
                    The <code>on_failure</code> strategy that was applied.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <h3 id="events-plan">Plan events</h3>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">plan.user_replied</span>
          </div>
          <p class="action-desc">
            Fires when a human comments on the issue after
            <code>ai.plan</code> posts an implementation plan. The daemon checks
            whether the comment matches an approval pattern. If it does,
            <code>plan_approved</code> is <code>true</code> and the workflow can
            proceed to <code>ai.code</code>. Non-matching comments are treated
            as feedback — the text is automatically injected into the next
            <code>ai.plan</code> session when looping back, so Claude can revise
            the plan accordingly. Supported for GitHub, Asana, and Linear
            providers.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>approval_pattern</td>
                  <td>string</td>
                  <td><em>LGTM|looks good|approved?|…</em></td>
                  <td>
                    Regular expression matched against the comment body to
                    detect approval. Defaults to
                    <code
                      >(?i)(LGTM|looks good|approved?|proceed|go ahead|ship
                      it)</code
                    >. Override to match your team's preferred phrasing.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Type</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>plan_approved</td>
                  <td>bool</td>
                  <td>
                    <code>true</code> if the comment matched the approval
                    pattern, <code>false</code> if it did not. Inspect in a
                    <code>choice</code> state to branch on approval vs.
                    feedback.
                  </td>
                </tr>
                <tr>
                  <td>user_feedback</td>
                  <td>string</td>
                  <td>
                    Full text of the comment. Automatically passed to the next
                    <code>ai.plan</code> session when looping back for
                    re-planning.
                  </td>
                </tr>
                <tr>
                  <td>user_feedback_author</td>
                  <td>string</td>
                  <td>Username or display name of the commenter.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <h3 id="events-asana">Asana events</h3>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">asana.in_section</span>
          </div>
          <p class="action-desc">
            Fires when the Asana task has been moved to a specific named section
            within its configured project. Use this to gate on human board
            movements — for example, waiting for a PM to drag a card into
            &ldquo;Ready for Review&rdquo; before Claude opens a PR. Requires
            the <code>ASANA_PAT</code> environment variable and an Asana
            provider registered for the repository.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>section</td>
                  <td>string</td>
                  <td><em>required</em></td>
                  <td>
                    Section name to watch for. Matched case-insensitively
                    against the task's current section within the configured
                    project.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Type</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>section</td>
                  <td>string</td>
                  <td>The section name as specified in the workflow params.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <h3 id="events-linear">Linear events</h3>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">linear.in_state</span>
          </div>
          <p class="action-desc">
            Fires when the Linear issue has been moved to a specific named
            workflow state. Use this to gate on human state transitions in
            Linear — for example, waiting for a team lead to move an issue to
            &ldquo;In Progress&rdquo; before Claude begins coding. Requires
            the <code>LINEAR_API_KEY</code> environment variable and a Linear
            provider registered for the repository.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>state</td>
                  <td>string</td>
                  <td><em>required</em></td>
                  <td>
                    Workflow state name to watch for. Matched case-insensitively
                    against the issue's current state.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Type</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>state</td>
                  <td>string</td>
                  <td>The state name as specified in the workflow params.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Example workflows -->
        <h2 id="examples">Example workflows</h2>
        <p>
          Ready-made configs for common use cases. Copy any of these into
          <code>.erg/workflow.yaml</code> in your repo, or run
          <code>erg workflow init</code> to generate the CI-gate config as a
          starting point.
        </p>

        <h3 id="example-minimal">Minimal</h3>
        <p>
          Simple pipeline: code, open PR, wait for review + CI to pass together,
          merge. Uses <code>pr.mergeable</code> to combine approval and CI into
          a single wait state. The best starting point for most projects.
        </p>
        <div class="example-tabs">
          <div class="tab-bar">
            <button class="tab-btn active" onclick="switchTab(this, 'yaml')">
              yaml
            </button>
            <button class="tab-btn" onclick="switchTab(this, 'diagram')">
              diagram
            </button>
          </div>
          <div data-panel="yaml">
            <div class="code-block">
              <div class="code-header">
                <span class="code-filename">minimal.yaml</span>
              </div>
              <pre>
# Minimal workflow — code, open PR, wait for approval + CI, merge.
#
# Use this for small teams or bots where you want the simplest possible
# pipeline. Uses pr.mergeable to fire a single event when both review
# approval and CI pass, replacing the separate await_review + await_ci
# states from the default workflow.
#
# Highlights:
#   - pr.mergeable: combined review + CI wait in a single state
#   - squash merge for clean commit history
#   - settings block: max_concurrent, branch_prefix, cleanup_merged

workflow: minimal
start: coding

source:
  provider: github
  filter:
    label: queued

settings:
  max_concurrent: 5          # Allow up to 5 sessions running at once
  branch_prefix: bot/        # All branches will start with "bot/"
  cleanup_merged: true       # Delete branches and worktrees after merge

states:
  coding:
    type: task
    action: ai.code
    params:
      max_turns: 30
      max_duration: 20m
    next: open_pr
    error: failed

  open_pr:
    type: task
    action: github.create_pr
    params:
      link_issue: true
    next: await_merge
    error: failed

  # pr.mergeable fires when BOTH review approval AND CI pass.
  # No need to manage them as separate wait states.
  await_merge:
    type: wait
    event: pr.mergeable
    params:
      require_review: true   # Must be approved by a reviewer
      require_ci: true       # CI must pass
    timeout: 72h             # Time out after 3 days of inactivity
    timeout_next: timed_out
    next: merge
    error: failed

  # Comment on the PR and fail if the wait times out.
  timed_out:
    type: task
    action: github.comment_pr
    params:
      body: "This PR has been waiting 72h with no activity. Closing — re-label the issue to retry."
    next: failed
    error: failed

  merge:
    type: task
    action: github.merge
    params:
      method: squash         # Squash all commits into one for a clean history
      cleanup: true
    next: done

  done:
    type: succeed

  failed:
    type: fail</pre
              >
            </div>
          </div>
          <div data-panel="diagram" style="display: none">
            <div class="diagram-panel">
              <pre class="mermaid">
stateDiagram-v2
    [*] --> coding
    coding --> open_pr : ai.code
    open_pr --> await_merge : github.create_pr
    await_merge --> merge : pr.mergeable
    await_merge --> timed_out : timeout
    timed_out --> failed : github.comment_pr
    merge --> done : github.merge
    done --> [*]
    failed --> [*]</pre
              >
            </div>
          </div>
        </div>

        <h3 id="example-supervised">Supervised</h3>
        <p>
          The recommended starting workflow for most teams. Claude analyzes the
          issue and posts a structured implementation plan as an issue comment —
          <em>before writing any code</em>. A human approves the approach or
          leaves feedback; Claude revises and loops back until approved. Once
          the plan is signed off, the full PR lifecycle runs automatically.
        </p>
        <div class="example-tabs">
          <div class="tab-bar">
            <button class="tab-btn active" onclick="switchTab(this, 'yaml')">
              yaml
            </button>
            <button class="tab-btn" onclick="switchTab(this, 'diagram')">
              diagram
            </button>
          </div>
          <div data-panel="yaml">
            <div class="code-block">
              <div class="code-header">
                <span class="code-filename">supervised.yaml</span>
              </div>
              <pre>
# Supervised workflow — plan first, get human approval, then code.
#
# Claude analyzes the issue and codebase in read-only mode, then posts
# a structured implementation plan as an issue comment. A human reviews
# the plan and replies to approve or give feedback. Claude loops back to
# revise the plan until approved, then proceeds to code and open a PR.
#
# Label an issue "plan" to trigger this workflow.
#
# Highlights:
#   - ai.plan: read-only session, posts plan as issue comment (no branch created)
#   - plan.user_replied: waits for human feedback on the plan
#   - choice state routes on plan_approved: approved → coding, feedback → re-plan
#   - label transitions for visibility: plan → plan-review → in-progress
#   - pr.mergeable: combined review + CI wait before merge

workflow: supervised
start: planning

source:
  provider: github
  filter:
    label: plan              # Label an issue "plan" to trigger this workflow

settings:
  max_concurrent: 3
  branch_prefix: bot/
  cleanup_merged: true

states:
  # Claude explores the codebase and posts a plan as an issue comment.
  # Read-only: no branch is created, no code is written.
  planning:
    type: task
    action: ai.plan
    params:
      max_turns: 30
      max_duration: 15m
    next: remove_plan_label
    error: notify_failed

  # Swap labels so the issue shows it is ready for plan review.
  remove_plan_label:
    type: task
    action: github.remove_label
    params:
      label: plan
    next: add_plan_review_label

  add_plan_review_label:
    type: task
    action: github.add_label
    params:
      label: plan-review
    next: await_plan_feedback

  # Wait for a human to comment on the issue.
  # Reply "LGTM", "approved", "proceed", etc. to approve.
  # Any other reply is treated as feedback — Claude will revise the plan.
  await_plan_feedback:
    type: wait
    event: plan.user_replied
    params:
      approval_pattern: '(?i)(LGTM|looks good|approved?|proceed|go ahead|ship it)'
    timeout: 72h
    timeout_next: plan_expired
    next: check_plan_feedback
    error: notify_failed

  # Route based on whether the human approved or gave feedback.
  check_plan_feedback:
    type: choice
    choices:
      - variable: plan_approved
        equals: true
        next: remove_plan_review_label   # Approved → proceed to coding
      - variable: plan_approved
        equals: false
        next: planning                   # Feedback → revise and re-post the plan
    default: notify_failed

  remove_plan_review_label:
    type: task
    action: github.remove_label
    params:
      label: plan-review
    next: add_in_progress_label

  add_in_progress_label:
    type: task
    action: github.add_label
    params:
      label: in-progress
    next: coding

  # Plan approved — Claude now creates a branch and writes the code.
  coding:
    type: task
    action: ai.code
    params:
      max_turns: 50
      max_duration: 30m
    next: open_pr
    error: notify_failed

  open_pr:
    type: task
    action: github.create_pr
    params:
      link_issue: true
    next: await_merge
    error: notify_failed

  # pr.mergeable fires when BOTH review approval AND CI pass.
  await_merge:
    type: wait
    event: pr.mergeable
    params:
      require_review: true
      require_ci: true
    timeout: 72h
    timeout_next: review_overdue
    next: merge
    error: notify_failed

  merge:
    type: task
    action: github.merge
    params:
      method: squash
      cleanup: true
    next: done

  # Comment on the issue if the plan is not approved within 72h.
  plan_expired:
    type: task
    action: github.comment_issue
    params:
      body: "The implementation plan has been awaiting approval for 72h. Re-label the issue to restart."
    next: failed
    error: failed

  review_overdue:
    type: task
    action: github.comment_pr
    params:
      body: "This PR has been awaiting review for 72h. Could a maintainer take a look?"
    next: notify_failed
    error: notify_failed

  notify_failed:
    type: task
    action: github.comment_issue
    params:
      body: "Unable to complete automatically. Manual intervention required."
    next: failed
    error: failed

  done:
    type: succeed

  failed:
    type: fail</pre
              >
            </div>
          </div>
          <div data-panel="diagram" style="display: none">
            <div class="diagram-panel">
              <pre class="mermaid">
stateDiagram-v2
    [*] --> planning
    planning --> remove_plan_label : ai.plan
    remove_plan_label --> add_plan_review_label : github.remove_label
    add_plan_review_label --> await_plan_feedback : github.add_label
    await_plan_feedback --> check_plan_feedback : plan.user_replied
    await_plan_feedback --> plan_expired : timeout
    check_plan_feedback --> remove_plan_review_label : plan_approved is true
    check_plan_feedback --> planning : plan_approved is false
    remove_plan_review_label --> add_in_progress_label : github.remove_label
    add_in_progress_label --> coding : github.add_label
    coding --> open_pr : ai.code
    open_pr --> await_merge : github.create_pr
    await_merge --> merge : pr.mergeable
    await_merge --> review_overdue : timeout
    review_overdue --> notify_failed : github.comment_pr
    merge --> done : github.merge
    plan_expired --> failed : github.comment_issue
    notify_failed --> failed : github.comment_issue
    done --> [*]
    failed --> [*]</pre
              >
            </div>
          </div>
        </div>

        <h3 id="example-ci-gate">CI gate</h3>
        <p>
          CI must pass before a reviewer is assigned. A
          <code>choice</code> state routes on the CI result: green goes to
          review, red triggers a Claude fix loop, merge conflicts are rebased
          automatically or resolved by Claude. Failures comment on the issue
          before terminating. This is what <code>erg workflow init</code>
          generates.
        </p>
        <div class="example-tabs">
          <div class="tab-bar">
            <button class="tab-btn active" onclick="switchTab(this, 'yaml')">
              yaml
            </button>
            <button class="tab-btn" onclick="switchTab(this, 'diagram')">
              diagram
            </button>
          </div>
          <div data-panel="yaml">
            <div class="code-block">
              <div class="code-header">
                <span class="code-filename">ci-gate.yaml</span>
              </div>
              <pre>
# CI-gate workflow — CI must pass before any human reviews the code.
#
# Use this for open-source projects or teams where failing CI wastes
# reviewers' time. Claude automatically attempts to fix CI failures
# and merge conflicts before requesting review from a designated maintainer.
#
# Highlights:
#   - CI runs before review (open_pr → await_ci → check_ci → request_reviewer)
#   - choice state routes CI results: pass → reviewer, fail → fix loop
#   - ai.fix_ci loop (bounded by max_ci_fix_rounds) with choice-gated cycle
#   - Merge conflict handling: git.rebase → ai.resolve_conflicts fallback
#   - github.request_review to assign a specific reviewer once CI is green
#   - notify_failed comments on the issue before terminating

workflow: ci-gate
start: coding

source:
  provider: github
  filter:
    label: queued

states:
  coding:
    type: task
    action: ai.code
    params:
      max_turns: 50
      max_duration: 30m
    next: open_pr
    error: notify_failed

  open_pr:
    type: task
    action: github.create_pr
    params:
      link_issue: true
    next: await_ci              # Check CI before requesting review
    error: notify_failed

  await_ci:
    type: wait
    event: ci.complete
    timeout: 2h
    timeout_next: ci_timed_out
    params:
      on_failure: fix           # Fire event with ci_failed=true on CI failure
    next: check_ci              # Route based on CI result
    error: notify_failed

  # Branch on the CI result written into step data by ci.complete.
  check_ci:
    type: choice
    choices:
      - variable: conflicting
        equals: true
        next: rebase            # Merge conflicts → rebase onto main
      - variable: ci_passed
        equals: true
        next: request_reviewer  # CI green → assign reviewer
      - variable: ci_failed
        equals: true
        next: fix_ci            # CI red → let Claude fix it
    default: notify_failed

  # Rebase branch onto main to resolve merge conflicts.
  rebase:
    type: task
    action: git.rebase
    params:
      max_rebase_rounds: 3
    next: await_ci
    error: resolve_conflicts    # If rebase fails, use Claude

  # Claude resolves merge conflicts that mechanical rebase cannot handle.
  resolve_conflicts:
    type: task
    action: ai.resolve_conflicts
    params:
      max_conflict_rounds: 3
    next: push_conflict_fix
    error: notify_failed

  push_conflict_fix:
    type: task
    action: github.push
    next: await_ci
    error: notify_failed

  # Claude attempts to fix failing CI. Loops back through check_ci (choice
  # state), which keeps the cycle valid per the workflow engine rules.
  fix_ci:
    type: task
    action: ai.fix_ci
    params:
      max_ci_fix_rounds: 3      # Give up after 3 unsuccessful fix attempts
    next: push_ci_fix
    error: ci_unfixable

  push_ci_fix:
    type: task
    action: github.push
    next: await_ci              # Loop back: await_ci → check_ci → fix_ci (cycle through choice)
    error: notify_failed

  # Notify when all fix attempts are exhausted.
  ci_unfixable:
    type: task
    action: github.comment_pr
    params:
      body: "CI fix attempts exhausted after 3 rounds. Manual intervention required."
    next: notify_failed
    error: notify_failed

  ci_timed_out:
    type: task
    action: github.comment_pr
    params:
      body: "CI has been running for over 2h. Please check the CI pipeline."
    next: notify_failed
    error: notify_failed

  # Assign a reviewer only after CI is green, avoiding wasted review time.
  request_reviewer:
    type: task
    action: github.request_review
    params:
      reviewer: your-github-username   # Replace with the reviewer's GitHub username
    next: await_review
    error: await_review               # If request fails, still wait for review

  await_review:
    type: wait
    event: pr.reviewed
    timeout: 48h
    timeout_next: review_overdue
    params:
      auto_address: true
      max_feedback_rounds: 3
    next: merge
    error: notify_failed

  # Comment on the issue when review takes too long, then fail.
  review_overdue:
    type: task
    action: github.comment_issue
    params:
      body: "This PR has been awaiting review for 48h. Could a maintainer take a look?"
    next: notify_failed
    error: notify_failed

  merge:
    type: task
    action: github.merge
    params:
      method: rebase
      cleanup: true
    next: done

  done:
    type: succeed

  notify_failed:
    type: task
    action: github.comment_issue
    params:
      body: "Unable to complete automatically. Manual intervention required."
    next: failed
    error: failed

  failed:
    type: fail</pre
              >
            </div>
          </div>
          <div data-panel="diagram" style="display: none">
            <div class="diagram-panel">
              <pre class="mermaid">
stateDiagram-v2
    [*] --> coding
    coding --> open_pr : ai.code
    open_pr --> await_ci : github.create_pr
    await_ci --> check_ci : ci.complete
    await_ci --> ci_timed_out : timeout
    check_ci --> rebase : conflicting is true
    check_ci --> request_reviewer : ci_passed is true
    check_ci --> fix_ci : ci_failed is true
    check_ci --> notify_failed : default
    rebase --> await_ci : git.rebase
    rebase --> resolve_conflicts : error
    resolve_conflicts --> push_conflict_fix : ai.resolve_conflicts
    push_conflict_fix --> await_ci : github.push
    fix_ci --> push_ci_fix : ai.fix_ci
    fix_ci --> ci_unfixable : error
    push_ci_fix --> await_ci : github.push
    ci_unfixable --> notify_failed : github.comment_pr
    ci_timed_out --> notify_failed : github.comment_pr
    request_reviewer --> await_review : github.request_review
    await_review --> merge : pr.reviewed
    await_review --> review_overdue : timeout
    review_overdue --> notify_failed : github.comment_issue
    merge --> done : github.merge
    notify_failed --> failed : github.comment_issue
    done --> [*]
    failed --> [*]</pre
              >
            </div>
          </div>
        </div>

        <h3 id="example-label-tracking">Label tracking</h3>
        <p>
          Issues move through GitHub labels as they advance:
          <code>queued</code> → <code>in-progress</code> →
          <code>in-review</code>. A <code>pass</code> state injects config
          flags, and a <code>choice</code> state reads them to conditionally
          close the source issue after merge.
        </p>
        <div class="example-tabs">
          <div class="tab-bar">
            <button class="tab-btn active" onclick="switchTab(this, 'yaml')">
              yaml
            </button>
            <button class="tab-btn" onclick="switchTab(this, 'diagram')">
              diagram
            </button>
          </div>
          <div data-panel="yaml">
            <div class="code-block">
              <div class="code-header">
                <span class="code-filename">label-tracking.yaml</span>
              </div>
              <pre>
# Label-tracking workflow — use GitHub labels to show workflow progress.
#
# Issues move through labels as they advance: queued → in-progress →
# in-review, and the source issue is closed automatically after merge.
# A pass state at the top injects configuration flags that a downstream
# choice state reads to decide whether to auto-close the issue.
#
# Highlights:
#   - pass state to inject workflow configuration at startup
#   - choice state reads pass-state data to conditionally close the issue
#   - github.add_label / github.remove_label for real-time status tracking
#   - github.close_issue to close the source issue after merge

workflow: label-tracking
start: configure

source:
  provider: github
  filter:
    label: queued

states:
  # Inject static workflow configuration into step data.
  # Downstream states can read these values via choice rules.
  configure:
    type: pass
    data:
      close_issue_on_merge: true   # Set to false to keep the issue open after merge
    next: start_coding

  # Remove the "queued" label and add "in-progress" when work begins.
  start_coding:
    type: task
    action: github.remove_label
    params:
      label: queued
    next: label_in_progress
    error: label_in_progress       # Continue even if the label was already missing

  label_in_progress:
    type: task
    action: github.add_label
    params:
      label: in-progress
    next: coding
    error: coding                  # Continue even if labeling fails

  coding:
    type: task
    action: ai.code
    params:
      max_turns: 50
      max_duration: 30m
    next: label_in_review
    error: label_failed

  # Swap labels from "in-progress" to "in-review" before opening the PR.
  label_in_review:
    type: task
    action: github.remove_label
    params:
      label: in-progress
    next: add_in_review
    error: add_in_review

  add_in_review:
    type: task
    action: github.add_label
    params:
      label: in-review
    next: open_pr
    error: open_pr

  open_pr:
    type: task
    action: github.create_pr
    params:
      link_issue: true
    next: await_merge
    error: label_failed

  await_merge:
    type: wait
    event: pr.mergeable
    params:
      require_review: true
      require_ci: true
    timeout: 72h
    timeout_next: label_failed     # Route to label_failed after 3 days of inactivity
    next: merge
    error: label_failed

  merge:
    type: task
    action: github.merge
    params:
      method: rebase
      cleanup: true
    next: check_close

  # Read the close_issue_on_merge flag set by the configure pass state.
  check_close:
    type: choice
    choices:
      - variable: close_issue_on_merge
        equals: true
        next: close_issue
    default: done

  close_issue:
    type: task
    action: github.close_issue     # Close the source issue after a successful merge
    next: done
    error: done                    # Proceed to done even if the close fails

  done:
    type: succeed

  # Add a "bot-failed" label so failed issues are easy to find.
  label_failed:
    type: task
    action: github.add_label
    params:
      label: bot-failed
    next: failed
    error: failed

  failed:
    type: fail</pre
              >
            </div>
          </div>
          <div data-panel="diagram" style="display: none">
            <div class="diagram-panel">
              <pre class="mermaid">
stateDiagram-v2
    [*] --> configure
    configure --> start_coding : pass
    start_coding --> label_in_progress : github.remove_label
    label_in_progress --> coding : github.add_label
    coding --> label_in_review : ai.code
    coding --> label_failed : error
    label_in_review --> add_in_review : github.remove_label
    add_in_review --> open_pr : github.add_label
    open_pr --> await_merge : github.create_pr
    open_pr --> label_failed : error
    await_merge --> merge : pr.mergeable
    await_merge --> label_failed : timeout
    merge --> check_close : github.merge
    check_close --> close_issue : close_issue_on_merge is true
    check_close --> done : default
    close_issue --> done : github.close_issue
    label_failed --> failed : github.add_label
    done --> [*]
    failed --> [*]</pre
              >
            </div>
          </div>
        </div>

        <h3 id="example-asana-kanban">Asana kanban</h3>
        <p>
          A board-section-driven workflow for Asana. Tasks in the
          <em>Todo</em> section are picked up automatically — no tag required.
          Claude plans and posts a comment; the card moves to
          <em>Planned</em>. Human feedback triggers re-planning; dragging the
          card to <em>Doing</em> starts coding. After the PR opens the card
          moves to <em>In Review</em>, then to <em>Done</em> on merge.
        </p>
        <div class="example-tabs">
          <div class="tab-bar">
            <button class="tab-btn active" onclick="switchTab(this, 'yaml')">
              yaml
            </button>
            <button class="tab-btn" onclick="switchTab(this, 'diagram')">
              diagram
            </button>
          </div>
          <div data-panel="yaml">
            <div class="code-block">
              <div class="code-header">
                <span class="code-filename">asana-kanban.yaml</span>
              </div>
              <pre>
# Asana kanban workflow — board sections drive the lifecycle.
#
# Section flow: Todo → Planned → Doing → In Review → Done
#
# Tasks in the "Todo" section are picked up automatically.
# No tag is required — section position is the only trigger.
#
# Highlights:
#   - source.filter.section: poll a named board section, not a tag
#   - asana.move_to_section: advance the card as work progresses
#   - plan.user_replied: comment feedback triggers re-planning
#   - asana.in_section: gate on a human dragging the card to "Doing"
#   - pr.mergeable: combined review + CI wait before merge

workflow: asana-kanban
start: planning

source:
  provider: asana
  filter:
    project: YOUR_PROJECT_GID   # found in the project URL
    section: Todo               # poll tasks in this board section

settings:
  max_concurrent: 3
  branch_prefix: bot/
  cleanup_merged: true

states:
  # Claude explores the codebase and posts a plan as an Asana comment.
  planning:
    type: task
    action: ai.plan
    params:
      max_turns: 30
      max_duration: 15m
    next: move_to_planned
    error: notify_failed

  # Slide the card to "Planned" to signal the plan is ready for review.
  move_to_planned:
    type: task
    action: asana.move_to_section
    params:
      section: Planned
    next: await_plan_feedback
    error: await_plan_feedback

  # Wait for a human to comment on the task.
  # Approval phrases advance to the coding gate; any other comment
  # is treated as feedback and loops back to re-plan.
  # After 24h of silence, move on to wait for the card to reach "Doing".
  await_plan_feedback:
    type: wait
    event: plan.user_replied
    params:
      approval_pattern: '(?i)(LGTM|looks good|approved?|proceed|go ahead|ship it)'
    timeout: 24h
    timeout_next: await_doing
    next: check_plan_feedback
    error: notify_failed

  check_plan_feedback:
    type: choice
    choices:
      - variable: plan_approved
        equals: true
        next: await_doing
      - variable: plan_approved
        equals: false
        next: planning          # Feedback → revise and re-post the plan
    default: planning

  # Gate on a human dragging the card to "Doing" on the board.
  # This is the explicit signal that the plan is accepted and work should begin.
  await_doing:
    type: wait
    event: asana.in_section
    params:
      section: Doing
    timeout: 7d
    timeout_next: plan_expired
    next: coding
    error: notify_failed

  # Plan accepted — Claude creates a branch and writes the code.
  coding:
    type: task
    action: ai.code
    params:
      max_turns: 50
      max_duration: 30m
    next: open_pr
    error: notify_failed

  open_pr:
    type: task
    action: github.create_pr
    params:
      link_issue: true
    next: move_to_in_review
    error: notify_failed

  # Advance the card to "In Review" while the PR is open.
  move_to_in_review:
    type: task
    action: asana.move_to_section
    params:
      section: In Review
    next: await_merge
    error: await_merge

  # pr.mergeable fires when BOTH review approval AND CI pass.
  await_merge:
    type: wait
    event: pr.mergeable
    params:
      require_review: true
      require_ci: true
    timeout: 72h
    timeout_next: review_overdue
    next: merge
    error: notify_failed

  merge:
    type: task
    action: github.merge
    params:
      method: rebase
      cleanup: true
    next: move_to_done
    error: notify_failed

  # Move the card to "Done" — the task is complete.
  move_to_done:
    type: task
    action: asana.move_to_section
    params:
      section: Done
    next: done
    error: done

  plan_expired:
    type: task
    action: asana.comment
    params:
      body: "Plan waiting 7 days for the card to move to 'Doing'. Move the card when ready, or remove it from Todo to cancel."
    next: failed
    error: failed

  review_overdue:
    type: task
    action: github.comment_pr
    params:
      body: "This PR has been awaiting review for 72h. Could a maintainer take a look?"
    next: notify_failed
    error: notify_failed

  notify_failed:
    type: task
    action: asana.comment
    params:
      body: "Unable to complete automatically. Manual intervention required."
    next: failed
    error: failed

  done:
    type: succeed

  failed:
    type: fail</pre
              >
            </div>
          </div>
          <div data-panel="diagram" style="display: none">
            <div class="diagram-panel">
              <pre class="mermaid">
stateDiagram-v2
    [*] --> planning
    planning --> move_to_planned : ai.plan
    planning --> notify_failed : error
    move_to_planned --> await_plan_feedback : asana.move_to_section
    await_plan_feedback --> check_plan_feedback : plan.user_replied
    await_plan_feedback --> await_doing : timeout (24h)
    check_plan_feedback --> await_doing : plan_approved is true
    check_plan_feedback --> planning : plan_approved is false
    await_doing --> coding : asana.in_section (Doing)
    await_doing --> plan_expired : timeout (7d)
    coding --> open_pr : ai.code
    coding --> notify_failed : error
    open_pr --> move_to_in_review : github.create_pr
    open_pr --> notify_failed : error
    move_to_in_review --> await_merge : asana.move_to_section
    await_merge --> merge : pr.mergeable
    await_merge --> review_overdue : timeout (72h)
    merge --> move_to_done : github.merge
    move_to_done --> done : asana.move_to_section
    review_overdue --> notify_failed : github.comment_pr
    plan_expired --> failed : asana.comment
    notify_failed --> failed : asana.comment
    done --> [*]
    failed --> [*]</pre
              >
            </div>
          </div>
        </div>

        <div
          style="
            margin-top: 3rem;
            padding-top: 1.5rem;
            border-top: 1px solid transparent;
            border-image: linear-gradient(
                90deg,
                transparent,
                var(--border-light),
                transparent
              )
              1;
            font-size: 0.8rem;
            color: var(--text-dim);
            text-align: center;
          "
        >
          made by
          <a href="https://www.zhubert.com" style="color: var(--accent)"
            >zack</a
          >
          &middot; mit license
        </div>
      </main>
    </div>

    <script>
      mermaid.initialize({ startOnLoad: false, theme: "dark" });

      function switchTab(btn, tab) {
        var tabs = btn.closest(".example-tabs");
        tabs.querySelectorAll(".tab-btn").forEach(function (b) {
          b.classList.remove("active");
        });
        btn.classList.add("active");
        tabs.querySelectorAll("[data-panel]").forEach(function (p) {
          p.style.display = "none";
        });
        var panel = tabs.querySelector('[data-panel="' + tab + '"]');
        if (panel) panel.style.display = "";
        if (tab === "diagram" && !tabs.dataset.rendered) {
          tabs.dataset.rendered = "1";
          var el = tabs.querySelector(".mermaid");
          if (el) mermaid.run({ nodes: [el] });
        }
      }

      function copyCmd(btn, cmd) {
        navigator.clipboard.writeText(cmd).then(function () {
          btn.textContent = "copied";
          btn.classList.add("copied");
          setTimeout(function () {
            btn.textContent = "copy";
            btn.classList.remove("copied");
          }, 2000);
        });
      }

      function toggleSidebar() {
        document.getElementById("sidebar").classList.toggle("open");
        document.getElementById("sidebarOverlay").classList.toggle("open");
      }

      // Scroll spy for sidebar
      (function () {
        var links = document.querySelectorAll(".sidebar-link");
        var sections = [];
        links.forEach(function (link) {
          var id = link.getAttribute("href");
          if (id && id.startsWith("#")) {
            var el = document.querySelector(id);
            if (el) sections.push({ el: el, link: link });
          }
        });

        function update() {
          var scrollY = window.scrollY + 80;
          var current = sections[0];
          for (var i = 0; i < sections.length; i++) {
            if (sections[i].el.offsetTop <= scrollY) {
              current = sections[i];
            }
          }
          links.forEach(function (l) {
            l.classList.remove("active");
          });
          if (current) current.link.classList.add("active");
        }

        window.addEventListener("scroll", update, { passive: true });
        update();
      })();

      // Close sidebar on link click (mobile)
      document
        .querySelectorAll(".sidebar-link, .sidebar-sublink")
        .forEach(function (link) {
          link.addEventListener("click", function () {
            if (window.innerWidth <= 860) {
              document.getElementById("sidebar").classList.remove("open");
              document
                .getElementById("sidebarOverlay")
                .classList.remove("open");
            }
          });
        });

      // Label param-table cells for responsive stacking
      document.querySelectorAll(".param-table").forEach(function (table) {
        var headers = Array.from(table.querySelectorAll("thead th")).map(
          function (th) {
            return th.textContent.trim();
          },
        );
        table.querySelectorAll("tbody tr").forEach(function (row) {
          row.querySelectorAll("td").forEach(function (td, i) {
            if (headers[i]) td.setAttribute("data-label", headers[i]);
          });
        });
      });
    </script>
  </body>
</html>
