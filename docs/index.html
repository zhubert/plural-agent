<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>erg - autonomous headless daemon for claude code</title>
    <meta
      name="description"
      content="Label an issue and let erg code, review, and merge autonomously. Headless daemon for Claude Code."
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,500;12..96,600;12..96,700;12..96,800&family=IBM+Plex+Sans:wght@400;500;600&family=IBM+Plex+Mono:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg: #141416;
        --bg-sidebar: #0f0f11;
        --bg-card: #1e1e21;
        --bg-code: #1a1a1d;
        --bg-inset: #111113;
        --accent: #f97316;
        --accent-dim: #ea580c;
        --accent-bg: rgba(249, 115, 22, 0.08);
        --accent-border: rgba(249, 115, 22, 0.2);
        --cyan: #22d3ee;
        --green: #34d399;
        --violet: #a78bfa;
        --text: #e4e4e7;
        --text-muted: #a1a1aa;
        --text-dim: #71717a;
        --border: #2a2a2e;
        --border-light: #3f3f46;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html {
        font-size: 100%;
        scroll-behavior: smooth;
        scroll-padding-top: 2rem;
      }

      body {
        font-family:
          "IBM Plex Sans",
          -apple-system,
          sans-serif;
        background: var(--bg);
        color: var(--text);
        line-height: 1.7;
        min-height: 100vh;
        -webkit-font-smoothing: antialiased;
        -webkit-text-size-adjust: 100%;
        text-size-adjust: 100%;
      }

      ::selection {
        background: var(--accent);
        color: #fff;
      }

      h1,
      h2,
      h3,
      h4 {
        font-family: "Bricolage Grotesque", sans-serif;
        letter-spacing: -0.02em;
      }

      code,
      pre {
        font-family: "IBM Plex Mono", monospace;
      }

      a {
        color: var(--accent);
        text-decoration: none;
      }

      a:hover {
        text-decoration: underline;
      }

      /* ---- Two-column layout ---- */

      .page {
        display: flex;
        min-height: 100vh;
      }

      /* ---- Sidebar ---- */

      .sidebar {
        width: 15rem;
        flex-shrink: 0;
        background: var(--bg-sidebar);
        border-right: 1px solid var(--border);
        position: sticky;
        top: 0;
        height: 100vh;
        overflow-y: auto;
        padding: 1.5rem 0;
        display: flex;
        flex-direction: column;
      }

      .sidebar-logo {
        padding: 0 1.25rem;
        margin-bottom: 1.75rem;
      }

      .sidebar-logo a {
        font-family: "Bricolage Grotesque", sans-serif;
        font-size: 1.6rem;
        font-weight: 800;
        color: var(--text);
        text-decoration: none;
        letter-spacing: -0.03em;
      }

      .sidebar-logo a span {
        color: var(--accent);
      }

      .sidebar-nav {
        list-style: none;
        flex: 1;
      }

      .sidebar-section {
        margin-bottom: 0.25rem;
      }

      .sidebar-section-title {
        display: block;
        padding: 0.4rem 1.25rem;
        font-size: 0.7rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        color: var(--text-dim);
        margin-top: 0.75rem;
      }

      .sidebar-link {
        display: block;
        padding: 0.35rem 1.25rem 0.35rem 1.75rem;
        font-size: 0.85rem;
        color: var(--text-muted);
        text-decoration: none;
        transition:
          color 0.15s,
          background 0.15s;
        border-left: 2px solid transparent;
      }

      .sidebar-link:hover {
        color: var(--text);
        background: rgba(255, 255, 255, 0.03);
        text-decoration: none;
      }

      .sidebar-link.active {
        color: var(--accent);
        border-left-color: var(--accent);
        background: var(--accent-bg);
      }

      .sidebar-footer {
        padding: 1rem 1.25rem 0;
        border-top: 1px solid var(--border);
        margin-top: auto;
      }

      .sidebar-footer a {
        display: block;
        font-size: 0.78rem;
        color: var(--text-dim);
        padding: 0.2rem 0;
        text-decoration: none;
      }

      .sidebar-footer a:hover {
        color: var(--text-muted);
        text-decoration: none;
      }

      /* ---- Main content ---- */

      .main {
        flex: 1;
        min-width: 0;
        max-width: 820px;
        padding: 2.5rem 3rem 4rem;
      }

      /* ---- Content typography ---- */

      .main h1 {
        font-size: 2.5rem;
        font-weight: 800;
        color: var(--text);
        margin-bottom: 0.75rem;
      }

      .main h2 {
        font-size: 1.4rem;
        font-weight: 700;
        color: var(--text);
        margin-top: 3.5rem;
        margin-bottom: 1rem;
        padding-top: 1.5rem;
        border-top: 1px solid var(--border);
      }

      .main h2:first-of-type {
        margin-top: 2.5rem;
      }

      .main h3 {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--text);
        margin-top: 2rem;
        margin-bottom: 0.5rem;
      }

      .main h4 {
        font-size: 0.95rem;
        font-weight: 600;
        color: var(--text);
        margin-top: 1.5rem;
        margin-bottom: 0.4rem;
      }

      .main p {
        margin-bottom: 1rem;
        color: var(--text-muted);
      }

      .main p code,
      .main li code {
        background: var(--bg-code);
        color: var(--cyan);
        padding: 0.15rem 0.4rem;
        border-radius: 4px;
        font-size: 0.85em;
        border: 1px solid var(--border);
      }

      .main ul,
      .main ol {
        margin-bottom: 1rem;
        padding-left: 1.5rem;
        color: var(--text-muted);
      }

      .main li {
        margin-bottom: 0.35rem;
        font-size: 0.95rem;
      }

      /* ---- Hero area ---- */

      .hero-badge {
        display: inline-block;
        font-family: "IBM Plex Mono", monospace;
        font-size: 0.72rem;
        font-weight: 500;
        color: var(--accent);
        background: var(--accent-bg);
        border: 1px solid var(--accent-border);
        border-radius: 100px;
        padding: 0.3rem 0.85rem;
        margin-bottom: 1rem;
        letter-spacing: 0.02em;
      }

      .hero-tagline {
        font-family: "Bricolage Grotesque", sans-serif;
        font-size: 1.15rem;
        font-weight: 500;
        color: var(--text-dim);
        margin-bottom: 1.5rem;
        letter-spacing: -0.01em;
      }

      .hero-cta {
        display: inline-flex;
        gap: 0.75rem;
        margin-bottom: 0.5rem;
      }

      .btn {
        display: inline-flex;
        align-items: center;
        padding: 0.55rem 1.25rem;
        border-radius: 6px;
        font-family: "IBM Plex Sans", sans-serif;
        font-size: 0.85rem;
        font-weight: 500;
        text-decoration: none;
        transition: all 0.15s;
        border: 1px solid transparent;
      }

      .btn:hover {
        text-decoration: none;
      }

      .btn-primary {
        background: var(--accent);
        color: #fff;
      }

      .btn-primary:hover {
        background: var(--accent-dim);
      }

      .btn-ghost {
        background: transparent;
        color: var(--text-muted);
        border-color: var(--border-light);
      }

      .btn-ghost:hover {
        color: var(--text);
        border-color: var(--text-dim);
      }

      /* ---- Feature grid ---- */

      .feature-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
        margin: 1rem 0 1.5rem;
      }

      .feature-item {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 1.1rem 1.25rem;
        transition: border-color 0.15s;
      }

      .feature-item:hover {
        border-color: var(--border-light);
      }

      .feature-item h4 {
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--text);
        margin: 0 0 0.3rem;
      }

      .feature-item .fi-icon {
        font-family: "IBM Plex Mono", monospace;
        font-size: 0.8rem;
        color: var(--accent);
        margin-bottom: 0.5rem;
        display: block;
      }

      .feature-item p {
        font-size: 0.82rem;
        color: var(--text-muted);
        line-height: 1.6;
        margin: 0;
      }

      /* ---- Steps (how it works) ---- */

      .steps-list {
        list-style: none;
        padding: 0;
        margin: 1rem 0 1.5rem;
        counter-reset: step;
      }

      .steps-list li {
        counter-increment: step;
        display: flex;
        gap: 1rem;
        align-items: flex-start;
        padding: 0.75rem 0;
        border-bottom: 1px solid var(--border);
        margin: 0;
      }

      .steps-list li:last-child {
        border-bottom: none;
      }

      .steps-list li::before {
        content: counter(step);
        display: flex;
        align-items: center;
        justify-content: center;
        width: 1.75rem;
        height: 1.75rem;
        border-radius: 50%;
        background: var(--accent-bg);
        border: 1px solid var(--accent-border);
        color: var(--accent);
        font-family: "Bricolage Grotesque", sans-serif;
        font-size: 0.78rem;
        font-weight: 700;
        flex-shrink: 0;
        margin-top: 0.1rem;
      }

      .step-body h4 {
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--text);
        margin: 0 0 0.15rem;
      }

      .step-body p {
        font-size: 0.85rem;
        color: var(--text-muted);
        margin: 0;
      }

      /* ---- State diagram ---- */

      .state-flow {
        display: flex;
        align-items: center;
        gap: 0;
        padding: 1.25rem 0;
        overflow-x: auto;
        margin: 0.5rem 0 0.75rem;
      }

      .sf-node {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.25rem;
        flex-shrink: 0;
      }

      .sf-box {
        font-family: "IBM Plex Mono", monospace;
        font-size: 0.78rem;
        font-weight: 500;
        padding: 0.4rem 0.75rem;
        border-radius: 4px;
        border: 1px solid var(--border);
        background: var(--bg-card);
        color: var(--text);
        white-space: nowrap;
      }

      .sf-box.sf-task {
        border-left: 3px solid var(--accent);
      }
      .sf-box.sf-wait {
        border-left: 3px solid var(--violet);
      }
      .sf-box.sf-done {
        border-left: 3px solid var(--green);
      }

      .sf-type {
        font-family: "IBM Plex Mono", monospace;
        font-size: 0.65rem;
        color: var(--text-dim);
      }

      .sf-step {
        display: flex;
        align-items: center;
      }

      .sf-arrow {
        color: var(--text-dim);
        font-size: 0.75rem;
        padding: 0 0.35rem;
        flex-shrink: 0;
        user-select: none;
      }

      .state-note {
        font-size: 0.82rem;
        color: var(--text-dim);
        margin-bottom: 1.5rem;
      }

      /* ---- Code block ---- */

      .code-block {
        background: var(--bg-inset);
        border: 1px solid var(--border);
        border-radius: 8px;
        overflow: hidden;
        margin: 1rem 0 1.5rem;
      }

      .code-header {
        background: var(--bg-card);
        border-bottom: 1px solid var(--border);
        padding: 0.5rem 1rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .code-filename {
        font-family: "IBM Plex Mono", monospace;
        font-size: 0.75rem;
        color: var(--text-dim);
      }

      .code-block pre {
        margin: 0;
        padding: 1rem 1.25rem;
        font-size: 0.8rem;
        line-height: 1.75;
        overflow-x: auto;
        color: var(--text-muted);
      }

      .code-block .ck {
        color: var(--accent);
      }
      .code-block .cv {
        color: var(--text);
      }
      .code-block .cc {
        color: var(--text-dim);
        font-style: italic;
      }
      .code-block .cs {
        color: var(--green);
      }
      .code-block .ca {
        color: var(--violet);
      }

      /* ---- Example tabs ---- */

      .example-tabs {
        margin: 1rem 0 1.5rem;
      }

      .tab-bar {
        display: flex;
        gap: 0.35rem;
        margin-bottom: 0.5rem;
      }

      .tab-btn {
        background: transparent;
        border: 1px solid var(--border);
        border-radius: 4px;
        color: var(--text-dim);
        padding: 0.3rem 0.8rem;
        font-family: "IBM Plex Mono", monospace;
        font-size: 0.73rem;
        cursor: pointer;
        transition:
          color 0.15s,
          border-color 0.15s,
          background 0.15s;
      }

      .tab-btn.active {
        color: var(--accent);
        border-color: var(--accent-border);
        background: var(--accent-bg);
      }

      .tab-btn:hover:not(.active) {
        color: var(--text-muted);
        border-color: var(--border-light);
      }

      .example-tabs [data-panel="yaml"] .code-block {
        margin: 0;
      }

      .diagram-panel {
        background: var(--bg-inset);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 1.5rem 1rem;
        overflow-x: auto;
      }

      .diagram-panel svg {
        max-width: 100%;
        height: auto;
        display: block;
        margin: 0 auto;
      }

      /* ---- Info cards ---- */

      .info-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
        margin: 1rem 0 1.5rem;
      }

      .info-card {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 1rem 1.15rem;
      }

      .info-card h4 {
        font-size: 0.88rem;
        font-weight: 600;
        color: var(--text);
        margin: 0 0 0.3rem;
      }

      .info-card p {
        font-size: 0.8rem;
        color: var(--text-muted);
        line-height: 1.6;
        margin: 0;
      }

      /* ---- CLI reference table ---- */

      .cli-table {
        width: 100%;
        border-collapse: collapse;
        margin: 1rem 0 1.5rem;
        font-size: 0.85rem;
      }

      .cli-table th {
        text-align: left;
        padding: 0.6rem 1rem;
        font-weight: 600;
        color: var(--text-dim);
        font-size: 0.72rem;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        border-bottom: 1px solid var(--border-light);
        background: var(--bg-card);
      }

      .cli-table td {
        padding: 0.6rem 1rem;
        border-bottom: 1px solid var(--border);
        color: var(--text-muted);
      }

      .cli-table td code {
        background: var(--bg-code);
        color: var(--cyan);
        padding: 0.15rem 0.4rem;
        border-radius: 3px;
        font-size: 0.82rem;
        border: 1px solid var(--border);
      }

      .cli-table tr:last-child td {
        border-bottom: none;
      }

      /* ---- Install block ---- */

      .install-block {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 0.9rem 1.25rem;
        position: relative;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin: 1rem 0;
        max-width: 520px;
      }

      .install-block .prompt-char {
        color: var(--accent);
        user-select: none;
        font-family: "IBM Plex Mono", monospace;
        font-weight: 500;
        font-size: 0.88rem;
      }

      .install-block code {
        font-size: 0.88rem;
        color: var(--text);
      }

      .copy-btn {
        position: absolute;
        right: 0.75rem;
        top: 50%;
        transform: translateY(-50%);
        background: var(--bg);
        border: 1px solid var(--border);
        color: var(--text-dim);
        padding: 0.3rem 0.65rem;
        border-radius: 4px;
        font-family: "IBM Plex Mono", monospace;
        font-size: 0.7rem;
        cursor: pointer;
        transition: all 0.15s;
      }

      .copy-btn:hover {
        border-color: var(--accent);
        color: var(--accent);
      }

      .copy-btn.copied {
        border-color: var(--green);
        color: var(--green);
      }

      /* ---- Mobile sidebar toggle ---- */

      .mobile-header {
        display: none;
        position: sticky;
        top: 0;
        z-index: 100;
        background: var(--bg-sidebar);
        border-bottom: 1px solid var(--border);
        padding: 0.75rem 1rem;
        align-items: center;
        justify-content: space-between;
      }

      .mobile-header .logo-text {
        font-family: "Bricolage Grotesque", sans-serif;
        font-size: 1.1rem;
        font-weight: 800;
        color: var(--text);
      }

      .mobile-header .logo-text span {
        color: var(--accent);
      }

      .menu-btn {
        background: none;
        border: 1px solid var(--border);
        color: var(--text-muted);
        padding: 0.3rem 0.6rem;
        border-radius: 4px;
        font-family: "IBM Plex Mono", monospace;
        font-size: 0.75rem;
        cursor: pointer;
      }

      /* ---- Responsive ---- */

      @media (max-width: 860px) {
        .sidebar {
          position: fixed;
          left: -16.25rem;
          z-index: 200;
          transition: left 0.25s ease;
          box-shadow: 4px 0 20px rgba(0, 0, 0, 0.5);
        }

        .sidebar.open {
          left: 0;
        }

        .sidebar-overlay {
          display: none;
          position: fixed;
          inset: 0;
          background: rgba(0, 0, 0, 0.5);
          z-index: 199;
        }

        .sidebar-overlay.open {
          display: block;
        }

        .mobile-header {
          display: flex;
        }

        .main {
          padding: 1.5rem 1.25rem 3rem;
        }

        .feature-grid,
        .info-grid {
          grid-template-columns: 1fr;
        }

        .feature-item,
        .info-card,
        .action-ref {
          overflow: hidden;
          overflow-wrap: break-word;
          word-break: break-word;
          min-width: 0;
        }

        .install-block {
          max-width: 100%;
          flex-wrap: wrap;
        }

        .cli-table {
          display: block;
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
        }

        .state-flow {
          padding: 1rem 0;
          flex-wrap: wrap;
        }
      }

      /* ---- Sidebar sub-links (category TOC) ---- */

      .sidebar-sublink {
        display: block;
        padding: 0.2rem 1.25rem 0.2rem 2.75rem;
        font-size: 0.75rem;
        font-family: "IBM Plex Mono", monospace;
        color: var(--text-dim);
        text-decoration: none;
        transition: color 0.15s;
        line-height: 1.5;
      }

      .sidebar-sublink:hover {
        color: var(--text-muted);
        text-decoration: none;
      }

      /* ---- Action reference ---- */

      .action-ref {
        background: var(--bg-card);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 1.25rem 1.5rem;
        margin-bottom: 1rem;
      }

      .action-header {
        display: flex;
        align-items: center;
        gap: 0.6rem;
        margin-bottom: 0.5rem;
      }

      .action-title {
        font-family: "IBM Plex Mono", monospace;
        font-size: 0.95rem;
        font-weight: 600;
        color: var(--accent);
      }

      .action-desc {
        font-size: 0.88rem;
        color: var(--text-muted);
        margin-bottom: 0.75rem;
        line-height: 1.6;
      }

      .badge {
        display: inline-block;
        font-family: "IBM Plex Mono", monospace;
        font-size: 0.63rem;
        font-weight: 500;
        padding: 0.15rem 0.5rem;
        border-radius: 100px;
        flex-shrink: 0;
      }

      .badge-async {
        background: rgba(167, 139, 250, 0.1);
        border: 1px solid rgba(167, 139, 250, 0.25);
        color: var(--violet);
      }

      .badge-sync {
        background: rgba(52, 211, 153, 0.1);
        border: 1px solid rgba(52, 211, 153, 0.25);
        color: var(--green);
      }

      .param-section {
        margin-top: 0.85rem;
      }

      .param-section-title {
        font-size: 0.68rem;
        font-weight: 600;
        color: var(--text-dim);
        text-transform: uppercase;
        letter-spacing: 0.07em;
        margin-bottom: 0.4rem;
      }

      .param-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.82rem;
        border-radius: 6px;
        overflow: hidden;
        border: 1px solid var(--border);
      }

      .param-table th {
        text-align: left;
        padding: 0.4rem 0.75rem;
        font-size: 0.66rem;
        font-weight: 600;
        color: var(--text-dim);
        text-transform: uppercase;
        letter-spacing: 0.07em;
        background: var(--bg-inset);
        border-bottom: 1px solid var(--border-light);
      }

      .param-table td {
        padding: 0.45rem 0.75rem;
        border-bottom: 1px solid var(--border);
        color: var(--text-muted);
        vertical-align: top;
      }

      .param-table td:first-child {
        font-family: "IBM Plex Mono", monospace;
        color: var(--cyan);
        font-size: 0.8rem;
        white-space: nowrap;
      }

      .param-table td:nth-child(2) {
        font-family: "IBM Plex Mono", monospace;
        color: var(--text-dim);
        font-size: 0.78rem;
        white-space: nowrap;
      }

      .param-table tr:last-child td {
        border-bottom: none;
      }

      .param-none {
        font-size: 0.82rem;
        color: var(--text-dim);
        margin-top: 0.35rem;
      }

      @media (max-width: 480px) {
        .main h1 {
          font-size: 1.6rem;
        }

        .hero-cta {
          flex-direction: column;
        }

        .btn {
          width: 100%;
          justify-content: center;
          max-width: 280px;
        }

        .cli-table {
          font-size: 0.78rem;
        }

        .cli-table th,
        .cli-table td {
          padding: 0.5rem 0.6rem;
        }

        .code-block pre {
          font-size: 0.72rem;
          padding: 0.75rem 1rem;
        }

        .action-ref {
          padding: 1rem;
        }

        .action-title {
          font-size: 0.85rem;
        }

        .action-desc {
          font-size: 0.82rem;
        }
      }

      /* ---- Scrollable param-table on narrow phones ---- */
      @media (max-width: 560px) {
        .param-section {
          overflow-x: auto;
          -webkit-overflow-scrolling: touch;
          margin-left: -0.25rem;
          margin-right: -0.25rem;
        }

        .param-table {
          font-size: 0.75rem;
          width: max-content;
          min-width: 100%;
        }

        .param-table th {
          white-space: nowrap;
        }

        .param-table th,
        .param-table td {
          padding: 0.35rem 0.5rem;
        }

        .param-table td:first-child {
          font-size: 0.73rem;
        }

        .param-table td:nth-child(2) {
          font-size: 0.7rem;
        }

        .install-block {
          gap: 0.35rem;
        }

        .install-block code {
          font-size: 0.78rem;
        }

        .copy-btn {
          position: static;
          transform: none;
          flex-shrink: 0;
          padding: 0.25rem 0.5rem;
          font-size: 0.65rem;
        }
      }
    </style>
    <script src="./mermaid.min.js"></script>
  </head>
  <body>
    <div class="mobile-header">
      <span class="logo-text">erg<span>.</span></span>
      <button class="menu-btn" onclick="toggleSidebar()">menu</button>
    </div>

    <div
      class="sidebar-overlay"
      id="sidebarOverlay"
      onclick="toggleSidebar()"
    ></div>

    <div class="page">
      <!-- Sidebar -->
      <nav class="sidebar" id="sidebar">
        <div class="sidebar-logo">
          <a href="#">erg<span>.</span></a>
        </div>
        <ul class="sidebar-nav">
          <li class="sidebar-section">
            <span class="sidebar-section-title">Getting started</span>
            <a href="#overview" class="sidebar-link active">Overview</a>
            <a href="#how-it-works" class="sidebar-link">How it works</a>
            <a href="#install" class="sidebar-link">Installation</a>
            <a href="#quickstart-github" class="sidebar-sublink">GitHub</a>
            <a href="#quickstart-asana" class="sidebar-sublink">Asana</a>
            <a href="#quickstart-linear" class="sidebar-sublink">Linear</a>
          </li>
          <li class="sidebar-section">
            <span class="sidebar-section-title">Workflow</span>
            <a href="#workflow" class="sidebar-link">Configuration</a>
            <a href="#states" class="sidebar-link">State types</a>
            <a href="#state-task" class="sidebar-sublink">task</a>
            <a href="#state-wait" class="sidebar-sublink">wait</a>
            <a href="#state-choice" class="sidebar-sublink">choice</a>
            <a href="#state-pass" class="sidebar-sublink">pass</a>
            <a href="#error-handling" class="sidebar-link">Error handling</a>
            <a href="#hooks" class="sidebar-link">Hooks</a>
          </li>
          <li class="sidebar-section">
            <span class="sidebar-section-title">Reference</span>
            <a href="#cli" class="sidebar-link">CLI commands</a>
            <a href="#actions" class="sidebar-link">Actions</a>
            <a href="#actions-ai" class="sidebar-sublink">ai</a>
            <a href="#actions-github" class="sidebar-sublink">github</a>
            <a href="#actions-git" class="sidebar-sublink">git</a>
            <a href="#events" class="sidebar-link">Wait events</a>
            <a href="#events-pr" class="sidebar-sublink">pr</a>
            <a href="#events-ci" class="sidebar-sublink">ci</a>
          </li>
          <li class="sidebar-section">
            <span class="sidebar-section-title">Examples</span>
            <a href="#example-minimal" class="sidebar-link">Minimal</a>
            <a href="#example-supervised" class="sidebar-link">Supervised</a>
            <a href="#example-ci-gate" class="sidebar-link">CI gate</a>
            <a href="#example-label-tracking" class="sidebar-link"
              >Label tracking</a
            >
            <a href="#example-asana" class="sidebar-link">Asana</a>
            <a href="#example-linear" class="sidebar-link">Linear</a>
          </li>
        </ul>
        <div class="sidebar-footer">
          <a href="https://github.com/zhubert/erg">GitHub</a>
          <a href="https://github.com/zhubert/erg/issues">Issues</a>
        </div>
      </nav>

      <!-- Content -->
      <main class="main">
        <!-- Overview -->
        <section id="overview">
          <span class="hero-badge">autonomous coding daemon</span>
          <h1>erg<span style="color: var(--accent)">.</span></h1>
          <p class="hero-tagline">label an issue. ship a PR.</p>
          <p>
            Autonomous headless daemon for Claude Code. Polls GitHub, Asana, or
            Linear for issues, starts containerized Claude sessions, and drives
            the full PR lifecycle &mdash; as automated as your workflow allows.
          </p>
          <div class="hero-cta">
            <a href="#install" class="btn btn-primary">install</a>
            <a href="https://github.com/zhubert/erg" class="btn btn-ghost"
              >view on github</a
            >
          </div>
        </section>

        <div class="feature-grid">
          <div class="feature-item">
            <span class="fi-icon">#</span>
            <h4>issue polling</h4>
            <p>
              Polls GitHub, Asana, or Linear for new issues. Label an issue
              <code>queued</code> and the agent picks it up.
            </p>
          </div>
          <div class="feature-item">
            <span class="fi-icon">[ ]</span>
            <h4>containerized sessions</h4>
            <p>
              Every session runs inside a Docker container. The container is the
              sandbox &mdash; Claude has full permissions.
            </p>
          </div>
          <div class="feature-item">
            <span class="fi-icon">//</span>
            <h4>concurrent workers</h4>
            <p>
              Process multiple issues in parallel. Each gets its own branch,
              container, and Claude session.
            </p>
          </div>
          <div class="feature-item">
            <span class="fi-icon">&lt;&gt;</span>
            <h4>PR lifecycle</h4>
            <p>
              Creates PRs, addresses review comments, waits for CI, and
              auto-merges. Full lifecycle management.
            </p>
          </div>
          <div class="feature-item">
            <span class="fi-icon">~</span>
            <h4>workflow engine</h4>
            <p>
              Configurable state machine via <code>.erg/workflow.yaml</code>.
              Task, wait, choice, and pass states with retry, catch, and
              timeout.
            </p>
          </div>
          <div class="feature-item">
            <span class="fi-icon">*</span>
            <h4>child sessions</h4>
            <p>
              Claude can delegate subtasks to child sessions via MCP tools. The
              supervisor waits for all children before creating a PR.
            </p>
          </div>
        </div>

        <!-- How it works -->
        <h2 id="how-it-works">How it works</h2>
        <p>
          At its core, erg is a <strong>state machine engine paired with AI
          coding</strong>. Each issue becomes a work item that advances through
          a configurable flowchart of states — from AI-generated code to a
          merged PR. You define exactly how much automation applies: require
          human review, auto-merge after CI, loop back for fixes, or notify
          external systems at any step.
        </p>
        <ol class="steps-list">
          <li>
            <div class="step-body">
              <h4>Tag or label an issue</h4>
              <p>
                Mark a task in GitHub, Asana, or Linear with the configured
                trigger label (e.g. <code>queued</code>).
              </p>
            </div>
          </li>
          <li>
            <div class="step-body">
              <h4>Daemon picks it up</h4>
              <p>
                erg creates a branch and starts a containerized Claude Code
                session with full tool access to the codebase.
              </p>
            </div>
          </li>
          <li>
            <div class="step-body">
              <h4>Claude writes code</h4>
              <p>
                Claude reads the issue, implements the changes, runs tests,
                and commits to the branch.
              </p>
            </div>
          </li>
          <li>
            <div class="step-body">
              <h4>State machine advances</h4>
              <p>
                The workflow engine moves the item through your configured
                states: open a PR, wait for CI, request review, auto-fix
                failures, merge.
              </p>
            </div>
          </li>
          <li>
            <div class="step-body">
              <h4>Your rules, your automation</h4>
              <p>
                Every transition, timeout, retry, and notification is defined
                in <code>.erg/workflow.yaml</code>. The built-in default
                handles most projects out of the box.
              </p>
            </div>
          </li>
        </ol>

        <!-- Installation -->
        <h2 id="install">Installation</h2>
        <h3>Homebrew</h3>
        <div class="install-block">
          <span class="prompt-char">$</span>
          <code>brew install zhubert/tap/erg</code>
          <button
            class="copy-btn"
            onclick="copyCmd(this, 'brew install zhubert/tap/erg')"
          >
            copy
          </button>
        </div>

        <h3>Build from source</h3>
        <div class="install-block">
          <span class="prompt-char">$</span>
          <code>go build -o erg .</code>
          <button class="copy-btn" onclick="copyCmd(this, 'go build -o erg .')">
            copy
          </button>
        </div>

        <h3 id="quickstart-github">Quick start: GitHub</h3>
        <p>
          GitHub issues are the simplest starting point. erg uses the
          <code>gh</code> CLI for all GitHub operations, so install and
          authenticate it first.
        </p>
        <div class="install-block">
          <span class="prompt-char">$</span>
          <code>gh auth login</code>
          <button class="copy-btn" onclick="copyCmd(this, 'gh auth login')">copy</button>
        </div>
        <p>
          Scaffold a default workflow config in your repo, then start the
          daemon:
        </p>
        <div class="install-block">
          <span class="prompt-char">$</span>
          <code>erg workflow init --repo /path/to/repo</code>
          <button class="copy-btn" onclick="copyCmd(this, 'erg workflow init --repo /path/to/repo')">copy</button>
        </div>
        <div class="install-block">
          <span class="prompt-char">$</span>
          <code>erg start --repo owner/repo</code>
          <button class="copy-btn" onclick="copyCmd(this, 'erg start --repo owner/repo')">copy</button>
        </div>
        <p>
          Label a GitHub issue <code>queued</code> and erg will pick it up on
          the next poll cycle. Use <code>erg status</code> to check progress or
          <code>erg stop</code> to shut down the daemon.
        </p>

        <h3 id="quickstart-asana">Quick start: Asana</h3>
        <p>
          To poll Asana tasks, create a Personal Access Token at
          <a href="https://app.asana.com/0/my-apps">app.asana.com/0/my-apps</a>
          and export it:
        </p>
        <div class="install-block">
          <span class="prompt-char">$</span>
          <code>export ASANA_PAT=your_personal_access_token</code>
          <button class="copy-btn" onclick="copyCmd(this, 'export ASANA_PAT=your_personal_access_token')">copy</button>
        </div>
        <p>
          Scaffold a workflow, then edit <code>.erg/workflow.yaml</code> to set
          the Asana provider and your project GID (found in the Asana project
          URL: <code>app.asana.com/0/&lt;PROJECT_GID&gt;/...</code>):
        </p>
        <div class="code-block">
          <div class="code-header">
            <span class="code-filename">.erg/workflow.yaml (source block)</span>
          </div>
          <pre><span class="ck">source:</span>
  <span class="ck">provider:</span> <span class="cv">asana</span>
  <span class="ck">filter:</span>
    <span class="ck">project:</span> <span class="cv">YOUR_ASANA_PROJECT_GID</span>
    <span class="ck">label:</span> <span class="cv">queued</span>    <span class="cc"># Asana tag name (case-insensitive)</span></pre>
        </div>
        <p>
          Start the daemon and tag an Asana task with <code>queued</code>. erg
          will poll the project and pick it up automatically.
        </p>

        <h3 id="quickstart-linear">Quick start: Linear</h3>
        <p>
          To poll Linear issues, create a Personal API key at
          <strong>Linear → Settings → API → Personal API keys</strong>
          and export it:
        </p>
        <div class="install-block">
          <span class="prompt-char">$</span>
          <code>export LINEAR_API_KEY=your_api_key</code>
          <button class="copy-btn" onclick="copyCmd(this, 'export LINEAR_API_KEY=your_api_key')">copy</button>
        </div>
        <p>
          Find your team ID at <strong>Linear → Settings → Teams → &lt;Your
          Team&gt; → Team ID</strong>, then configure the workflow:
        </p>
        <div class="code-block">
          <div class="code-header">
            <span class="code-filename">.erg/workflow.yaml (source block)</span>
          </div>
          <pre><span class="ck">source:</span>
  <span class="ck">provider:</span> <span class="cv">linear</span>
  <span class="ck">filter:</span>
    <span class="ck">team:</span> <span class="cv">YOUR_LINEAR_TEAM_ID</span>
    <span class="ck">label:</span> <span class="cv">queued</span>    <span class="cc"># Linear label (case-insensitive)</span></pre>
        </div>
        <p>
          Start the daemon and label a Linear issue <code>queued</code>. erg
          will poll the team and begin processing it.
        </p>

        <!-- Workflow configuration -->
        <h2 id="workflow">Workflow configuration</h2>
        <p>
          A workflow is a directed flowchart that routes each issue from the
          first commit to a merged PR. You define <em>states</em> (nodes),
          the actions or events that drive each state, and the transitions
          between them. Run <code>erg workflow init</code> inside your repo to
          scaffold a starting point, or omit the file entirely to use the
          built-in defaults.
        </p>
        <p>
          The <code>settings</code> block controls daemon-level behaviour:
          concurrency limits, branch naming, merge strategy, and session
          constraints. The <code>source</code> block selects the issue provider
          and filter. The <code>states</code> block is the flowchart itself.
        </p>

        <h3>Pipeline overview</h3>
        <div class="state-flow">
          <div class="sf-step">
            <div class="sf-node">
              <div class="sf-box sf-task">coding</div>
              <span class="sf-type">ai.code</span>
            </div>
            <span class="sf-arrow">&rarr;</span>
          </div>
          <div class="sf-step">
            <div class="sf-node">
              <div class="sf-box sf-task">open_pr</div>
              <span class="sf-type">github.create_pr</span>
            </div>
            <span class="sf-arrow">&rarr;</span>
          </div>
          <div class="sf-step">
            <div class="sf-node">
              <div class="sf-box sf-wait">await_review</div>
              <span class="sf-type">pr.reviewed</span>
            </div>
            <span class="sf-arrow">&rarr;</span>
          </div>
          <div class="sf-step">
            <div class="sf-node">
              <div class="sf-box sf-wait">await_ci</div>
              <span class="sf-type">ci.complete</span>
            </div>
            <span class="sf-arrow">&rarr;</span>
          </div>
          <div class="sf-step">
            <div class="sf-node">
              <div class="sf-box sf-task">merge</div>
              <span class="sf-type">github.merge</span>
            </div>
            <span class="sf-arrow">&rarr;</span>
          </div>
          <div class="sf-node">
            <div class="sf-box sf-done">done</div>
            <span class="sf-type">succeed</span>
          </div>
        </div>
        <p class="state-note">
          <code>retry</code> with exponential backoff &middot;
          <code>catch</code> to recovery states &middot;
          <code>timeout</code> enforced on wait states
        </p>

        <h3>Example config</h3>
        <div class="code-block">
          <div class="code-header">
            <span class="code-filename">.erg/workflow.yaml</span>
          </div>
          <pre><span class="ck">source:</span>
  <span class="ck">provider:</span> <span class="cv">github</span>            <span class="cc"># github | asana | linear</span>
  <span class="ck">filter:</span>
    <span class="ck">label:</span> <span class="cv">queued</span>              <span class="cc"># matches labels (GitHub), tags (Asana), or labels (Linear)</span>

<span class="ck">states:</span>
  <span class="ck">coding:</span>
    <span class="ck">type:</span> <span class="cs">task</span>
    <span class="ck">action:</span> <span class="ca">ai.code</span>
    <span class="ck">params:</span>
      <span class="ck">max_turns:</span> <span class="cv">50</span>
      <span class="ck">max_duration:</span> <span class="cv">30m</span>
      <span class="ck">system_prompt:</span> <span class="cv">file:.erg/prompt.md</span>
    <span class="ck">before:</span>                        <span class="cc"># runs before step; failure blocks</span>
      <span class="cv">- run: "make deps"</span>
    <span class="ck">after:</span>                         <span class="cc"># runs after; fire-and-forget</span>
      <span class="cv">- run: "make lint"</span>
    <span class="ck">retry:</span>                         <span class="cc"># retry with exponential backoff</span>
      - <span class="ck">max_attempts:</span> <span class="cv">3</span>
        <span class="ck">interval:</span> <span class="cv">30s</span>
        <span class="ck">backoff_rate:</span> <span class="cv">2.0</span>
    <span class="ck">next:</span> <span class="cv">open_pr</span>
    <span class="ck">error:</span> <span class="cv">failed</span>

  <span class="ck">await_review:</span>
    <span class="ck">type:</span> <span class="cs">wait</span>
    <span class="ck">event:</span> <span class="ca">pr.reviewed</span>
    <span class="ck">timeout:</span> <span class="cv">48h</span>                  <span class="cc"># enforced at runtime</span>
    <span class="ck">timeout_next:</span> <span class="cv">nudge_reviewers</span>  <span class="cc"># dedicated timeout edge</span>
    <span class="ck">params:</span>
      <span class="ck">auto_address:</span> <span class="cv">true</span>
      <span class="ck">max_feedback_rounds:</span> <span class="cv">3</span>

  <span class="ck">merge:</span>
    <span class="ck">type:</span> <span class="cs">task</span>
    <span class="ck">action:</span> <span class="ca">github.merge</span>
    <span class="ck">params:</span>
      <span class="ck">method:</span> <span class="cv">squash</span>            <span class="cc"># rebase | squash | merge</span></pre>
        </div>

        <!-- State types -->
        <h3 id="states">State types</h3>
        <p>
          Each state in the workflow has a type that determines its behavior.
        </p>
        <table class="cli-table">
          <thead>
            <tr>
              <th>Type</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>task</code></td>
              <td>
                Execute an action (e.g. <code>ai.code</code>,
                <code>github.merge</code>)
              </td>
            </tr>
            <tr>
              <td><code>wait</code></td>
              <td>
                Poll for an event with an enforced timeout (e.g.
                <code>pr.reviewed</code>, <code>ci.complete</code>)
              </td>
            </tr>
            <tr>
              <td><code>choice</code></td>
              <td>
                Evaluate rules against step data for conditional branching
              </td>
            </tr>
            <tr>
              <td><code>pass</code></td>
              <td>Inject data for downstream states to read</td>
            </tr>
            <tr>
              <td><code>succeed</code></td>
              <td>Terminal state &mdash; marks the work item as complete</td>
            </tr>
            <tr>
              <td><code>fail</code></td>
              <td>Terminal state &mdash; marks the work item as failed</td>
            </tr>
          </tbody>
        </table>

        <h3 id="state-task">task</h3>
        <p>
          A <code>task</code> state executes a registered action and then
          transitions to <code>next</code> on success or <code>error</code> on
          failure. Every action that calls an external API (GitHub, Asana,
          Linear, git remotes) should define a <code>retry</code> block.
          Network failures are transient — without retry, a momentary outage
          permanently fails the work item.
        </p>
        <div class="code-block">
          <div class="code-header"><span class="code-filename">retry example</span></div>
          <pre><span class="ck">open_pr:</span>
  <span class="ck">type:</span> <span class="cs">task</span>
  <span class="ck">action:</span> <span class="ca">github.create_pr</span>
  <span class="ck">retry:</span>
    - <span class="ck">max_attempts:</span> <span class="cv">3</span>
      <span class="ck">interval:</span> <span class="cv">15s</span>
      <span class="ck">backoff_rate:</span> <span class="cv">2.0</span>   <span class="cc"># waits 15s, 30s, 60s</span>
  <span class="ck">next:</span> <span class="cv">await_review</span>
  <span class="ck">error:</span> <span class="cv">failed</span></pre>
        </div>
        <p>
          Use <code>catch</code> to route specific error types to recovery
          states instead of the generic <code>error</code> edge. Use
          <code>before</code> hooks to run setup scripts (blocking) and
          <code>after</code> hooks for teardown (fire-and-forget).
        </p>

        <h3 id="state-wait">wait</h3>
        <p>
          A <code>wait</code> state polls for an external event on each daemon
          tick. It does not advance until the event fires. Always set a
          <code>timeout</code> to prevent indefinite waits &mdash; use
          <code>timeout_next</code> to route the timeout to a dedicated state
          (e.g. post a comment) rather than the generic <code>error</code> edge.
        </p>
        <div class="code-block">
          <div class="code-header"><span class="code-filename">wait example</span></div>
          <pre><span class="ck">await_review:</span>
  <span class="ck">type:</span> <span class="cs">wait</span>
  <span class="ck">event:</span> <span class="ca">pr.reviewed</span>
  <span class="ck">timeout:</span> <span class="cv">72h</span>
  <span class="ck">timeout_next:</span> <span class="cv">nudge_reviewers</span>
  <span class="ck">params:</span>
    <span class="ck">auto_address:</span> <span class="cv">true</span>          <span class="cc"># Claude addresses feedback while waiting</span>
    <span class="ck">max_feedback_rounds:</span> <span class="cv">3</span>
  <span class="ck">next:</span> <span class="cv">merge</span>
  <span class="ck">error:</span> <span class="cv">failed</span></pre>
        </div>
        <p>
          The <code>pr.mergeable</code> event is a shorthand that combines
          <code>pr.reviewed</code> and <code>ci.complete</code> into a single
          wait state. Use it for simple pipelines where you want both conditions
          satisfied before proceeding.
        </p>

        <h3 id="state-choice">choice</h3>
        <p>
          A <code>choice</code> state reads values from the accumulated step
          data and branches to different states based on rules. Each rule
          specifies a <code>variable</code>, an <code>equals</code> value, and
          a <code>next</code> state. The <code>default</code> route fires when
          no rule matches.
        </p>
        <div class="code-block">
          <div class="code-header"><span class="code-filename">choice example</span></div>
          <pre><span class="ck">check_ci:</span>
  <span class="ck">type:</span> <span class="cs">choice</span>
  <span class="ck">choices:</span>
    - <span class="ck">variable:</span> <span class="cv">ci_passed</span>
      <span class="ck">equals:</span> <span class="cv">true</span>
      <span class="ck">next:</span> <span class="cv">request_reviewer</span>
    - <span class="ck">variable:</span> <span class="cv">ci_failed</span>
      <span class="ck">equals:</span> <span class="cv">true</span>
      <span class="ck">next:</span> <span class="cv">fix_ci</span>
  <span class="ck">default:</span> <span class="cv">failed</span></pre>
        </div>
        <p>
          Choice states are the branching points of your flowchart. Combine
          them with <code>pass</code> states to make decisions on injected
          configuration flags, or with CI/review wait states to route on
          outcomes.
        </p>

        <h3 id="state-pass">pass</h3>
        <p>
          A <code>pass</code> state injects static data into the workflow
          context and immediately transitions to <code>next</code>. Use it at
          the start of a workflow to set configuration flags that downstream
          <code>choice</code> states can inspect.
        </p>
        <div class="code-block">
          <div class="code-header"><span class="code-filename">pass example</span></div>
          <pre><span class="ck">configure:</span>
  <span class="ck">type:</span> <span class="cs">pass</span>
  <span class="ck">data:</span>
    <span class="ck">close_issue_on_merge:</span> <span class="cv">true</span>
    <span class="ck">max_ci_fix_rounds:</span> <span class="cv">3</span>
  <span class="ck">next:</span> <span class="cv">coding</span></pre>
        </div>

        <!-- Error handling -->
        <h3 id="error-handling">Error handling</h3>
        <div class="info-grid">
          <div class="info-card">
            <h4>retry</h4>
            <p>
              Task states support <code>retry</code> with configurable
              <code>max_attempts</code>, <code>interval</code>, and exponential
              <code>backoff_rate</code>.
            </p>
          </div>
          <div class="info-card">
            <h4>catch</h4>
            <p>
              Route specific errors to recovery states with
              <code>catch</code> blocks. Match by error type or message pattern.
            </p>
          </div>
          <div class="info-card">
            <h4>timeout</h4>
            <p>
              Wait states enforce <code>timeout</code> durations at runtime.
              <code>timeout_next</code> provides a dedicated transition edge.
            </p>
          </div>
          <div class="info-card">
            <h4>error state</h4>
            <p>
              Every task state can define an <code>error</code> transition for
              unrecoverable failures. Defaults to the
              <code>failed</code> terminal state.
            </p>
          </div>
        </div>

        <!-- Hooks -->
        <h3 id="hooks">Hooks</h3>
        <p>
          <code>before</code> hooks run before step execution &mdash; if they
          fail, the step is blocked. <code>after</code> hooks run after
          completion and are fire-and-forget.
        </p>
        <p>
          Hooks receive environment variables including
          <code>$ERG_BRANCH</code>, <code>$ERG_PR_URL</code>,
          <code>$ERG_ISSUE_URL</code>, and more.
        </p>


        <!-- CLI reference -->
        <h2 id="cli">CLI commands</h2>
        <p>
          The most commonly used commands are listed below. Run any command with
          <code>-h</code> to see all available flags.
        </p>
        <table class="cli-table">
          <thead>
            <tr>
              <th>Command</th>
              <th>Description</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td><code>erg start --repo owner/repo</code></td>
              <td>Start daemon in the background (prints PID and exits)</td>
            </tr>
            <tr>
              <td><code>erg start -f --repo owner/repo</code></td>
              <td>Start in foreground with live status display</td>
            </tr>
            <tr>
              <td><code>erg stop</code></td>
              <td>Gracefully shut down the running daemon</td>
            </tr>
            <tr>
              <td><code>erg status</code></td>
              <td>Show daemon status (PID, uptime, active sessions)</td>
            </tr>
            <tr>
              <td><code>erg status --tail</code></td>
              <td>Live split-screen log view — one column per active session</td>
            </tr>
            <tr>
              <td><code>erg workflow init</code></td>
              <td>Scaffold a <code>.erg/workflow.yaml</code> in the current repo</td>
            </tr>
            <tr>
              <td><code>erg workflow validate</code></td>
              <td>Validate the workflow config for errors</td>
            </tr>
            <tr>
              <td><code>erg workflow visualize</code></td>
              <td>Emit a Mermaid diagram of the current workflow</td>
            </tr>
            <tr>
              <td><code>erg clean</code></td>
              <td>Clear daemon state and lock files</td>
            </tr>
          </tbody>
        </table>

        <!-- Action reference -->
        <h2 id="actions">Action reference</h2>
        <p>
          Actions are used in <code>task</code> states via the
          <code>action:</code> key. Each action accepts typed
          <code>params</code> and may produce output data that downstream
          <code>choice</code> states can inspect.
        </p>

        <h3 id="actions-ai">AI actions</h3>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">ai.code</span>
            <span class="badge badge-async">async</span>
          </div>
          <p class="action-desc">
            Starts an autonomous Claude Code session that reads the issue,
            writes code, runs tests, and commits changes locally. The daemon
            waits for the session to complete before advancing.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>max_turns</td>
                  <td>int</td>
                  <td>50</td>
                  <td>Maximum number of Claude turns per session.</td>
                </tr>
                <tr>
                  <td>max_duration</td>
                  <td>duration</td>
                  <td>30m</td>
                  <td>
                    Hard time limit for the session, e.g. <code>20m</code>,
                    <code>2h</code>.
                  </td>
                </tr>
                <tr>
                  <td>containerized</td>
                  <td>bool</td>
                  <td>true</td>
                  <td>Run Claude inside a Docker container sandbox.</td>
                </tr>
                <tr>
                  <td>supervisor</td>
                  <td>bool</td>
                  <td>false</td>
                  <td>
                    Enable multi-session mode — Claude can spawn child sessions
                    for parallel subtasks.
                  </td>
                </tr>
                <tr>
                  <td>system_prompt</td>
                  <td>string</td>
                  <td><em>built-in</em></td>
                  <td>
                    Inline prompt or <code>file:.erg/prompt.md</code> to load
                    from the repo. Overrides the default coding prompt.
                  </td>
                </tr>
                <tr>
                  <td>format_command</td>
                  <td>string</td>
                  <td><em>none</em></td>
                  <td>
                    Shell command to run as a formatter after coding completes
                    (e.g. <code>go fmt ./...</code>). Claude is also instructed
                    to run it before each commit. Omit to skip auto-formatting.
                  </td>
                </tr>
                <tr>
                  <td>format_message</td>
                  <td>string</td>
                  <td>Apply auto-formatting</td>
                  <td>
                    Commit message used when the daemon commits the
                    post-coding format pass. Only used when
                    <code>format_command</code> is set.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">
              None. Session completion is signalled internally; the daemon
              advances the state machine when the worker exits.
            </p>
          </div>
          <div class="param-section">
            <div class="param-section-title">Notes</div>
            <ul
              style="
                margin: 0.35rem 0 0;
                padding-left: 1.25rem;
                font-size: 0.82rem;
                color: var(--text-muted);
              "
            >
              <li>
                If the branch already has an open PR, coding is skipped and
                the workflow advances to <code>github.create_pr</code>, which
                detects the existing PR.
              </li>
              <li>
                If the branch was already merged, the issue is closed and the
                workflow jumps to <code>done</code>.
              </li>
            </ul>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">ai.fix_ci</span>
            <span class="badge badge-async">async</span>
          </div>
          <p class="action-desc">
            Resumes the existing Claude session to fix failing CI. Fetches
            failure logs from the most recent GitHub Actions run and passes
            them to Claude as context.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>max_ci_fix_rounds</td>
                  <td>int</td>
                  <td>3</td>
                  <td>
                    Maximum number of CI fix attempts before returning an
                    error.
                  </td>
                </tr>
                <tr>
                  <td>system_prompt</td>
                  <td>string</td>
                  <td><em>built-in</em></td>
                  <td>Custom system prompt for the fix session.</td>
                </tr>
                <tr>
                  <td>format_command</td>
                  <td>string</td>
                  <td><em>inherited</em></td>
                  <td>
                    Shell command to run as a formatter after each CI fix
                    round (e.g. <code>go fmt ./...</code>). Overrides the
                    value inherited from the <code>ai.code</code> step. Omit
                    to keep the inherited formatter or skip formatting.
                  </td>
                </tr>
                <tr>
                  <td>format_message</td>
                  <td>string</td>
                  <td>Apply auto-formatting</td>
                  <td>
                    Commit message used when the daemon commits the
                    post-fix-round format pass. Only used when
                    <code>format_command</code> is set (directly or
                    inherited).
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Type</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>ci_fix_rounds</td>
                  <td>int</td>
                  <td>
                    Incremented on each attempt. Inspect in
                    <code>choice</code> states to check round count.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <h3 id="actions-github">GitHub actions</h3>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">github.create_pr</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Opens a pull request from the working branch to the base branch.
            Detects and reuses an existing PR if one was already opened in a
            previous attempt.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>link_issue</td>
                  <td>bool</td>
                  <td>true</td>
                  <td>
                    Add a closing reference to the source issue in the PR body
                    (e.g. <code>Closes #42</code>).
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Type</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>pr_url</td>
                  <td>string</td>
                  <td>URL of the created (or existing) pull request.</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Notes</div>
            <ul
              style="
                margin: 0.35rem 0 0;
                padding-left: 1.25rem;
                font-size: 0.82rem;
                color: var(--text-muted);
              "
            >
              <li>
                If the coding session made no commits, the issue is closed
                automatically and the workflow skips to <code>done</code>.
              </li>
            </ul>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">github.push</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Pushes committed changes to the remote branch. Typically used
            after Claude addresses review feedback.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <p class="param-none">None.</p>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">github.merge</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Merges the pull request into the base branch using the configured
            strategy.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>method</td>
                  <td>string</td>
                  <td>rebase</td>
                  <td>
                    Merge strategy: <code>rebase</code>, <code>squash</code>,
                    or <code>merge</code>.
                  </td>
                </tr>
                <tr>
                  <td>cleanup</td>
                  <td>bool</td>
                  <td>false</td>
                  <td>
                    Delete the worktree and branch after a successful merge.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">github.comment_issue</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Posts a comment on the original issue associated with the work
            item.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>body</td>
                  <td>string</td>
                  <td><em>required</em></td>
                  <td>
                    Comment text. Prefix with <code>file:</code> to load
                    content from a repo path, e.g.
                    <code>file:.erg/comments/msg.md</code>.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">github.comment_pr</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Posts a comment on the pull request for the work item.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>body</td>
                  <td>string</td>
                  <td><em>required</em></td>
                  <td>
                    Comment text. Prefix with <code>file:</code> to load
                    content from a repo path, e.g.
                    <code>file:.erg/comments/msg.md</code>.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">github.add_label</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">Adds a label to the source issue.</p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>label</td>
                  <td>string</td>
                  <td><em>required</em></td>
                  <td>Label name to add.</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">github.remove_label</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">Removes a label from the source issue.</p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>label</td>
                  <td>string</td>
                  <td><em>required</em></td>
                  <td>Label name to remove.</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">github.close_issue</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">Closes the source issue.</p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <p class="param-none">None.</p>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">github.request_review</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Requests a review from a specific GitHub user on the pull request.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>reviewer</td>
                  <td>string</td>
                  <td><em>required</em></td>
                  <td>GitHub username to request a review from.</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <h3>Asana actions</h3>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">asana.comment</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Posts a comment on the Asana task associated with the work item.
            Requires the <code>ASANA_PAT</code> environment variable to be set
            and an Asana provider registered for the repository.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>body</td>
                  <td>string</td>
                  <td><em>required</em></td>
                  <td>
                    Comment text. Prefix with <code>file:</code> to load
                    content from a repo path, e.g.
                    <code>file:.erg/comments/msg.md</code>.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <h3>Linear actions</h3>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">linear.comment</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Posts a comment on the Linear issue associated with the work item.
            Requires the <code>LINEAR_API_KEY</code> environment variable to be
            set and a Linear provider registered for the repository.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>body</td>
                  <td>string</td>
                  <td><em>required</em></td>
                  <td>
                    Comment text. Prefix with <code>file:</code> to load
                    content from a repo path, e.g.
                    <code>file:.erg/comments/msg.md</code>.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <h3 id="actions-git">Git actions</h3>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">git.format</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Runs a formatter command in the session worktree, stages all
            changes with <code>git add -A</code>, and commits them. Silently
            succeeds if the formatter produces no changes.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>command</td>
                  <td>string</td>
                  <td><em>required</em></td>
                  <td>
                    Shell command to run, e.g. <code>gofmt -w .</code> or
                    <code>prettier --write .</code>.
                  </td>
                </tr>
                <tr>
                  <td>message</td>
                  <td>string</td>
                  <td>Apply auto-formatting</td>
                  <td>
                    Commit message used when the formatter produces changes.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <p class="param-none">None.</p>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">git.rebase</span>
            <span class="badge badge-sync">sync</span>
          </div>
          <p class="action-desc">
            Rebases the feature branch onto the latest base branch and
            force-pushes. This is a mechanical rebase — if real file-level
            conflicts exist, the rebase is aborted and an error is returned.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>max_rebase_rounds</td>
                  <td>int</td>
                  <td>3</td>
                  <td>
                    Maximum number of rebase attempts before returning an error.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Type</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>rebase_rounds</td>
                  <td>int</td>
                  <td>
                    Incremented on each attempt.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <h3 id="actions-ai-resolve">AI conflict resolution</h3>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">ai.resolve_conflicts</span>
            <span class="badge badge-async">async</span>
          </div>
          <p class="action-desc">
            Merges the base branch into the feature branch (leaving conflict
            markers in place), then starts a Claude session to resolve the
            conflicts. Claude reads each conflicted file, resolves the markers,
            stages the files, and commits the merge.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>max_conflict_rounds</td>
                  <td>int</td>
                  <td>3</td>
                  <td>
                    Maximum number of conflict resolution attempts before
                    returning an error.
                  </td>
                </tr>
                <tr>
                  <td>system_prompt</td>
                  <td>string</td>
                  <td><em>built-in</em></td>
                  <td>Custom system prompt for the resolution session.</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Type</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>conflict_rounds</td>
                  <td>int</td>
                  <td>
                    Incremented on each attempt. Inspect in
                    <code>choice</code> states to check round count.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Wait events reference -->
        <h2 id="events">Wait events</h2>
        <p>
          Events are used in <code>wait</code> states via the
          <code>event:</code> key. The daemon polls on each tick and advances
          the state machine when the event fires. All wait states support
          <code>timeout</code> and <code>timeout_next</code>.
        </p>

        <h3 id="events-pr">PR events</h3>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">pr.reviewed</span>
          </div>
          <p class="action-desc">
            Fires when the pull request receives a formal approval. While
            waiting, the daemon automatically resumes Claude to address new
            review comments (configurable via <code>auto_address</code>).
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>auto_address</td>
                  <td>bool</td>
                  <td>true</td>
                  <td>
                    Automatically resume Claude to address new review comments
                    while waiting for approval.
                  </td>
                </tr>
                <tr>
                  <td>max_feedback_rounds</td>
                  <td>int</td>
                  <td>3</td>
                  <td>
                    Maximum number of feedback rounds before
                    auto-addressing stops.
                  </td>
                </tr>
                <tr>
                  <td>format_command</td>
                  <td>string</td>
                  <td><em>inherited</em></td>
                  <td>
                    Shell command to run as a formatter after each review
                    feedback round (e.g. <code>go fmt ./...</code>). Overrides
                    the value inherited from the <code>ai.code</code> step.
                    Omit to keep the inherited formatter or skip formatting.
                  </td>
                </tr>
                <tr>
                  <td>format_message</td>
                  <td>string</td>
                  <td>Apply auto-formatting</td>
                  <td>
                    Commit message used when the daemon commits the
                    post-feedback format pass. Only used when
                    <code>format_command</code> is set (directly or
                    inherited).
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Type</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>review_approved</td>
                  <td>bool</td>
                  <td>Set to <code>true</code> when a reviewer approves.</td>
                </tr>
                <tr>
                  <td>pr_merged_externally</td>
                  <td>bool</td>
                  <td>
                    Set to <code>true</code> if the PR was merged outside the
                    daemon.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <h3 id="events-ci">CI events</h3>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">ci.complete</span>
          </div>
          <p class="action-desc">
            Fires when all CI checks on the PR pass. Configurable behaviour
            on CI failure lets workflows route to <code>ai.fix_ci</code> or
            other states.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>on_failure</td>
                  <td>string</td>
                  <td>retry</td>
                  <td>
                    Action when CI fails: <code>retry</code> — keep waiting
                    (default); <code>fix</code> — fire the event so the
                    workflow can route to <code>ai.fix_ci</code>;
                    <code>abandon</code> or <code>notify</code> — emit data
                    for downstream routing without advancing.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Type</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>ci_passed</td>
                  <td>bool</td>
                  <td>True when all checks pass.</td>
                </tr>
                <tr>
                  <td>ci_failed</td>
                  <td>bool</td>
                  <td>True when any check fails.</td>
                </tr>
                <tr>
                  <td>ci_action</td>
                  <td>string</td>
                  <td>
                    The <code>on_failure</code> strategy that was applied.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="action-ref">
          <div class="action-header">
            <span class="action-title">pr.mergeable</span>
          </div>
          <p class="action-desc">
            Convenience event that combines <code>pr.reviewed</code> and
            <code>ci.complete</code>. Fires only when both review approval
            and CI pass simultaneously. Useful for minimal pipelines that
            don't need separate wait states.
          </p>
          <div class="param-section">
            <div class="param-section-title">Params</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Type</th>
                  <th>Default</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>require_review</td>
                  <td>bool</td>
                  <td>true</td>
                  <td>Require an approved review before firing.</td>
                </tr>
                <tr>
                  <td>require_ci</td>
                  <td>bool</td>
                  <td>true</td>
                  <td>Require CI to pass before firing.</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="param-section">
            <div class="param-section-title">Output data</div>
            <table class="param-table">
              <thead>
                <tr>
                  <th>Key</th>
                  <th>Type</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>review_approved</td>
                  <td>bool</td>
                  <td>True when a reviewer has approved.</td>
                </tr>
                <tr>
                  <td>ci_passed</td>
                  <td>bool</td>
                  <td>True when all CI checks pass.</td>
                </tr>
                <tr>
                  <td>ci_failed</td>
                  <td>bool</td>
                  <td>True when any CI check fails.</td>
                </tr>
                <tr>
                  <td>pr_merged_externally</td>
                  <td>bool</td>
                  <td>True if the PR was merged outside the daemon.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Example workflows -->
        <h2 id="examples">Example workflows</h2>
        <p>
          Ready-made configs for common use cases. Copy any of these into
          <code>.erg/workflow.yaml</code> in your repo, or run
          <code>erg workflow init</code> to generate the CI-gate config as a
          starting point.
        </p>

        <h3 id="example-minimal">Minimal</h3>
        <p>
          Simple pipeline: code, open PR, wait for review + CI to pass together,
          merge. Uses <code>pr.mergeable</code> to combine approval and CI into
          a single wait state. The best starting point for most projects.
        </p>
        <div class="example-tabs">
          <div class="tab-bar">
            <button class="tab-btn active" onclick="switchTab(this, 'yaml')">
              yaml
            </button>
            <button class="tab-btn" onclick="switchTab(this, 'diagram')">
              diagram
            </button>
          </div>
          <div data-panel="yaml">
            <div class="code-block">
              <div class="code-header">
                <span class="code-filename">minimal.yaml</span>
              </div>
              <pre>
# Minimal workflow — code, open PR, wait for approval + CI, merge.
#
# Use this for small teams or bots where you want the simplest possible
# pipeline. Uses pr.mergeable to fire a single event when both review
# approval and CI pass, replacing the separate await_review + await_ci
# states from the default workflow.
#
# Highlights:
#   - pr.mergeable: combined review + CI wait in a single state
#   - squash merge for clean commit history
#   - settings block: max_concurrent, branch_prefix, cleanup_merged

workflow: minimal
start: coding

source:
  provider: github
  filter:
    label: queued

settings:
  max_concurrent: 5          # Allow up to 5 sessions running at once
  branch_prefix: bot/        # All branches will start with "bot/"
  cleanup_merged: true       # Delete branches and worktrees after merge

states:
  coding:
    type: task
    action: ai.code
    params:
      max_turns: 30
      max_duration: 20m
    next: open_pr
    error: failed

  open_pr:
    type: task
    action: github.create_pr
    params:
      link_issue: true
    next: await_merge
    error: failed

  # pr.mergeable fires when BOTH review approval AND CI pass.
  # No need to manage them as separate wait states.
  await_merge:
    type: wait
    event: pr.mergeable
    params:
      require_review: true   # Must be approved by a reviewer
      require_ci: true       # CI must pass
    timeout: 72h             # Time out after 3 days of inactivity
    timeout_next: timed_out
    next: merge
    error: failed

  # Comment on the PR and fail if the wait times out.
  timed_out:
    type: task
    action: github.comment_pr
    params:
      body: "This PR has been waiting 72h with no activity. Closing — re-label the issue to retry."
    next: failed
    error: failed

  merge:
    type: task
    action: github.merge
    params:
      method: squash         # Squash all commits into one for a clean history
      cleanup: true
    next: done

  done:
    type: succeed

  failed:
    type: fail</pre
              >
            </div>
          </div>
          <div data-panel="diagram" style="display: none">
            <div class="diagram-panel">
              <pre class="mermaid">
stateDiagram-v2
    [*] --> coding
    coding --> open_pr : ai.code
    coding --> failed : error
    open_pr --> await_merge : github.create_pr
    open_pr --> failed : error
    await_merge --> merge : pr.mergeable
    await_merge --> timed_out : timeout
    await_merge --> failed : error
    timed_out --> failed : github.comment_pr
    timed_out --> failed : error
    merge --> done : github.merge
    done --> [*]
    failed --> [*]</pre
              >
            </div>
          </div>
        </div>

        <h3 id="example-supervised">Supervised</h3>
        <p>
          For complex features spanning multiple files. Claude acts as a
          supervisor that can spawn child sessions for parallel work. Includes
          hooks, retry with exponential backoff, <code>catch</code>-based error
          routing, and a Slack notification after merge.
        </p>
        <div class="example-tabs">
          <div class="tab-bar">
            <button class="tab-btn active" onclick="switchTab(this, 'yaml')">
              yaml
            </button>
            <button class="tab-btn" onclick="switchTab(this, 'diagram')">
              diagram
            </button>
          </div>
          <div data-panel="yaml">
            <div class="code-block">
              <div class="code-header">
                <span class="code-filename">supervised.yaml</span>
              </div>
              <pre>
# Supervised workflow — for complex features spanning multiple files.
#
# Claude acts as a supervisor that can spawn child sessions for parallel
# work across different subsystems. A custom system prompt enforces
# architectural guidelines. Hooks install dependencies before coding and
# run lint checks after. Failed sessions are retried with exponential
# backoff before routing to a recovery state.
#
# Highlights:
#   - supervisor: true for multi-session task coordination
#   - system_prompt loaded from a file for per-repo AI guidelines
#   - before hooks (block on failure) and after hooks (fire-and-forget)
#   - retry with exponential backoff before catch-based error routing
#   - Slack webhook notification after merge via after hook

workflow: supervised-feature
start: coding

source:
  provider: github
  filter:
    label: feature-queued

settings:
  max_concurrent: 2          # Supervisor sessions are resource-heavy; limit concurrency
  branch_prefix: feature/
  cleanup_merged: true

states:
  coding:
    type: task
    action: ai.code
    params:
      max_turns: 100
      max_duration: 60m
      supervisor: true                                   # Enable multi-session coordination
      system_prompt: "file:.erg/prompts/feature.md"  # Architecture + style guidelines
    before:
      - run: "make deps"      # Install dependencies before Claude starts (blocks on failure)
      - run: "make generate"  # Run code generation (blocks on failure)
    after:
      - run: "make lint"      # Run lint after coding (logged on failure, does not block)
    retry:
      - max_attempts: 2
        interval: 60s
        backoff_rate: 2.0     # Wait 60s, then 120s between retries
        errors: ["*"]         # Retry on any failure
    catch:
      - errors: ["container_error"]
        next: notify_container_failure  # Container issues get a human-readable comment
      - errors: ["*"]
        next: failed                    # All other failures → fail
    next: open_pr
    error: failed

  open_pr:
    type: task
    action: github.create_pr
    params:
      link_issue: true
    next: await_ci
    error: failed

  await_ci:
    type: wait
    event: ci.complete
    timeout: 3h
    params:
      on_failure: retry       # Keep polling; CI may still pass on a subsequent run
    next: await_review
    error: failed

  await_review:
    type: wait
    event: pr.reviewed
    timeout: 72h
    timeout_next: review_overdue
    params:
      auto_address: true
      max_feedback_rounds: 5  # Allow more review rounds for complex features
      system_prompt: "file:.erg/prompts/review-feedback.md"
    next: merge
    error: failed

  # Comment on the PR and fail if review takes too long.
  review_overdue:
    type: task
    action: github.comment_pr
    params:
      body: "This PR has been awaiting review for 72h. Could a maintainer take a look?"
    next: failed
    error: failed

  merge:
    type: task
    action: github.merge
    params:
      method: rebase
      cleanup: true
    after:
      # Post to Slack after merge. SLACK_WEBHOOK_URL must be set in the environment.
      - run: |
          curl -s -X POST "$SLACK_WEBHOOK_URL" \
            -H 'Content-type: application/json' \
            --data "{\"text\": \"Feature merged: &lt;$ERG_PR_URL|$ERG_ISSUE_TITLE&gt;\"}"
    next: done

  # Post a comment when a container error prevents coding, then fail.
  notify_container_failure:
    type: task
    action: github.comment_issue
    params:
      body: "The coding session failed due to a container error. Please check the infrastructure and re-queue the issue."
    next: failed
    error: failed

  done:
    type: succeed

  failed:
    type: fail</pre
              >
            </div>
          </div>
          <div data-panel="diagram" style="display: none">
            <div class="diagram-panel">
              <pre class="mermaid">
stateDiagram-v2
    [*] --> coding
    coding_before --> coding : before hooks
    coding --> coding_hooks : after hooks
    coding --> open_pr : ai.code
    coding --> failed : error
    open_pr --> await_ci : github.create_pr
    open_pr --> failed : error
    await_ci --> await_review : ci.complete
    await_ci --> failed : error
    await_review --> merge : pr.reviewed
    await_review --> review_overdue : timeout
    await_review --> failed : error
    review_overdue --> failed : github.comment_pr
    review_overdue --> failed : error
    merge --> done : github.merge
    merge --> merge_hooks : after hooks
    notify_container_failure --> failed : github.comment_issue
    notify_container_failure --> failed : error
    done --> [*]
    failed --> [*]</pre
              >
            </div>
          </div>
        </div>

        <h3 id="example-ci-gate">CI gate</h3>
        <p>
          CI must pass before a reviewer is assigned. A
          <code>choice</code> state routes on the CI result: green goes to
          review, red triggers a Claude fix loop, merge conflicts are rebased
          automatically or resolved by Claude. Failures comment on the issue
          before terminating. This is what <code>erg workflow init</code>
          generates.
        </p>
        <div class="example-tabs">
          <div class="tab-bar">
            <button class="tab-btn active" onclick="switchTab(this, 'yaml')">
              yaml
            </button>
            <button class="tab-btn" onclick="switchTab(this, 'diagram')">
              diagram
            </button>
          </div>
          <div data-panel="yaml">
            <div class="code-block">
              <div class="code-header">
                <span class="code-filename">ci-gate.yaml</span>
              </div>
              <pre>
# CI-gate workflow — CI must pass before any human reviews the code.
#
# Use this for open-source projects or teams where failing CI wastes
# reviewers' time. Claude automatically attempts to fix CI failures
# and merge conflicts before requesting review from a designated maintainer.
#
# Highlights:
#   - CI runs before review (open_pr → await_ci → check_ci → request_reviewer)
#   - choice state routes CI results: pass → reviewer, fail → fix loop
#   - ai.fix_ci loop (bounded by max_ci_fix_rounds) with choice-gated cycle
#   - Merge conflict handling: git.rebase → ai.resolve_conflicts fallback
#   - github.request_review to assign a specific reviewer once CI is green
#   - notify_failed comments on the issue before terminating

workflow: ci-gate
start: coding

source:
  provider: github
  filter:
    label: queued

states:
  coding:
    type: task
    action: ai.code
    params:
      max_turns: 50
      max_duration: 30m
    next: open_pr
    error: notify_failed

  open_pr:
    type: task
    action: github.create_pr
    params:
      link_issue: true
    next: await_ci              # Check CI before requesting review
    error: notify_failed

  await_ci:
    type: wait
    event: ci.complete
    timeout: 2h
    timeout_next: ci_timed_out
    params:
      on_failure: fix           # Fire event with ci_failed=true on CI failure
    next: check_ci              # Route based on CI result
    error: notify_failed

  # Branch on the CI result written into step data by ci.complete.
  check_ci:
    type: choice
    choices:
      - variable: conflicting
        equals: true
        next: rebase            # Merge conflicts → rebase onto main
      - variable: ci_passed
        equals: true
        next: request_reviewer  # CI green → assign reviewer
      - variable: ci_failed
        equals: true
        next: fix_ci            # CI red → let Claude fix it
    default: notify_failed

  # Rebase branch onto main to resolve merge conflicts.
  rebase:
    type: task
    action: git.rebase
    params:
      max_rebase_rounds: 3
    next: await_ci
    error: resolve_conflicts    # If rebase fails, use Claude

  # Claude resolves merge conflicts that mechanical rebase cannot handle.
  resolve_conflicts:
    type: task
    action: ai.resolve_conflicts
    params:
      max_conflict_rounds: 3
    next: push_conflict_fix
    error: notify_failed

  push_conflict_fix:
    type: task
    action: github.push
    next: await_ci
    error: notify_failed

  # Claude attempts to fix failing CI. Loops back through check_ci (choice
  # state), which keeps the cycle valid per the workflow engine rules.
  fix_ci:
    type: task
    action: ai.fix_ci
    params:
      max_ci_fix_rounds: 3      # Give up after 3 unsuccessful fix attempts
    next: push_ci_fix
    error: ci_unfixable

  push_ci_fix:
    type: task
    action: github.push
    next: await_ci              # Loop back: await_ci → check_ci → fix_ci (cycle through choice)
    error: notify_failed

  # Notify when all fix attempts are exhausted.
  ci_unfixable:
    type: task
    action: github.comment_pr
    params:
      body: "CI fix attempts exhausted after 3 rounds. Manual intervention required."
    next: notify_failed
    error: notify_failed

  ci_timed_out:
    type: task
    action: github.comment_pr
    params:
      body: "CI has been running for over 2h. Please check the CI pipeline."
    next: notify_failed
    error: notify_failed

  # Assign a reviewer only after CI is green, avoiding wasted review time.
  request_reviewer:
    type: task
    action: github.request_review
    params:
      reviewer: your-github-username   # Replace with the reviewer's GitHub username
    next: await_review
    error: await_review               # If request fails, still wait for review

  await_review:
    type: wait
    event: pr.reviewed
    timeout: 48h
    timeout_next: review_overdue
    params:
      auto_address: true
      max_feedback_rounds: 3
    next: merge
    error: notify_failed

  # Comment on the issue when review takes too long, then fail.
  review_overdue:
    type: task
    action: github.comment_issue
    params:
      body: "This PR has been awaiting review for 48h. Could a maintainer take a look?"
    next: notify_failed
    error: notify_failed

  merge:
    type: task
    action: github.merge
    params:
      method: rebase
      cleanup: true
    next: done

  done:
    type: succeed

  notify_failed:
    type: task
    action: github.comment_issue
    params:
      body: "Unable to complete automatically. Manual intervention required."
    next: failed
    error: failed

  failed:
    type: fail</pre
              >
            </div>
          </div>
          <div data-panel="diagram" style="display: none">
            <div class="diagram-panel">
              <pre class="mermaid">
stateDiagram-v2
    [*] --> coding
    coding --> open_pr : ai.code
    coding --> notify_failed : error
    open_pr --> await_ci : github.create_pr
    open_pr --> notify_failed : error
    await_ci --> check_ci : ci.complete
    await_ci --> ci_timed_out : timeout
    await_ci --> notify_failed : error
    check_ci --> rebase : conflicting is true
    check_ci --> request_reviewer : ci_passed is true
    check_ci --> fix_ci : ci_failed is true
    check_ci --> notify_failed : default
    rebase --> await_ci : git.rebase
    rebase --> resolve_conflicts : error
    resolve_conflicts --> push_conflict_fix : ai.resolve_conflicts
    resolve_conflicts --> notify_failed : error
    push_conflict_fix --> await_ci : github.push
    push_conflict_fix --> notify_failed : error
    fix_ci --> push_ci_fix : ai.fix_ci
    fix_ci --> ci_unfixable : error
    push_ci_fix --> await_ci : github.push
    push_ci_fix --> notify_failed : error
    ci_unfixable --> notify_failed : github.comment_pr
    ci_timed_out --> notify_failed : github.comment_pr
    request_reviewer --> await_review : github.request_review
    request_reviewer --> await_review : error
    await_review --> merge : pr.reviewed
    await_review --> review_overdue : timeout
    await_review --> notify_failed : error
    review_overdue --> notify_failed : github.comment_issue
    merge --> done : github.merge
    notify_failed --> failed : github.comment_issue
    done --> [*]
    failed --> [*]</pre
              >
            </div>
          </div>
        </div>

        <h3 id="example-label-tracking">Label tracking</h3>
        <p>
          Issues move through GitHub labels as they advance:
          <code>queued</code> → <code>in-progress</code> →
          <code>in-review</code>. A <code>pass</code> state injects config
          flags, and a <code>choice</code> state reads them to conditionally
          close the source issue after merge.
        </p>
        <div class="example-tabs">
          <div class="tab-bar">
            <button class="tab-btn active" onclick="switchTab(this, 'yaml')">
              yaml
            </button>
            <button class="tab-btn" onclick="switchTab(this, 'diagram')">
              diagram
            </button>
          </div>
          <div data-panel="yaml">
            <div class="code-block">
              <div class="code-header">
                <span class="code-filename">label-tracking.yaml</span>
              </div>
              <pre>
# Label-tracking workflow — use GitHub labels to show workflow progress.
#
# Issues move through labels as they advance: queued → in-progress →
# in-review, and the source issue is closed automatically after merge.
# A pass state at the top injects configuration flags that a downstream
# choice state reads to decide whether to auto-close the issue.
#
# Highlights:
#   - pass state to inject workflow configuration at startup
#   - choice state reads pass-state data to conditionally close the issue
#   - github.add_label / github.remove_label for real-time status tracking
#   - github.close_issue to close the source issue after merge

workflow: label-tracking
start: configure

source:
  provider: github
  filter:
    label: queued

states:
  # Inject static workflow configuration into step data.
  # Downstream states can read these values via choice rules.
  configure:
    type: pass
    data:
      close_issue_on_merge: true   # Set to false to keep the issue open after merge
    next: start_coding

  # Remove the "queued" label and add "in-progress" when work begins.
  start_coding:
    type: task
    action: github.remove_label
    params:
      label: queued
    next: label_in_progress
    error: label_in_progress       # Continue even if the label was already missing

  label_in_progress:
    type: task
    action: github.add_label
    params:
      label: in-progress
    next: coding
    error: coding                  # Continue even if labeling fails

  coding:
    type: task
    action: ai.code
    params:
      max_turns: 50
      max_duration: 30m
    next: label_in_review
    error: label_failed

  # Swap labels from "in-progress" to "in-review" before opening the PR.
  label_in_review:
    type: task
    action: github.remove_label
    params:
      label: in-progress
    next: add_in_review
    error: add_in_review

  add_in_review:
    type: task
    action: github.add_label
    params:
      label: in-review
    next: open_pr
    error: open_pr

  open_pr:
    type: task
    action: github.create_pr
    params:
      link_issue: true
    next: await_merge
    error: label_failed

  await_merge:
    type: wait
    event: pr.mergeable
    params:
      require_review: true
      require_ci: true
    timeout: 72h
    timeout_next: label_failed     # Route to label_failed after 3 days of inactivity
    next: merge
    error: label_failed

  merge:
    type: task
    action: github.merge
    params:
      method: rebase
      cleanup: true
    next: check_close

  # Read the close_issue_on_merge flag set by the configure pass state.
  check_close:
    type: choice
    choices:
      - variable: close_issue_on_merge
        equals: true
        next: close_issue
    default: done

  close_issue:
    type: task
    action: github.close_issue     # Close the source issue after a successful merge
    next: done
    error: done                    # Proceed to done even if the close fails

  done:
    type: succeed

  # Add a "bot-failed" label so failed issues are easy to find.
  label_failed:
    type: task
    action: github.add_label
    params:
      label: bot-failed
    next: failed
    error: failed

  failed:
    type: fail</pre
              >
            </div>
          </div>
          <div data-panel="diagram" style="display: none">
            <div class="diagram-panel">
              <pre class="mermaid">
stateDiagram-v2
    [*] --> configure
    configure --> start_coding : pass
    start_coding --> label_in_progress : github.remove_label
    start_coding --> label_in_progress : error
    label_in_progress --> coding : github.add_label
    label_in_progress --> coding : error
    coding --> label_in_review : ai.code
    coding --> label_failed : error
    label_in_review --> add_in_review : github.remove_label
    label_in_review --> add_in_review : error
    add_in_review --> open_pr : github.add_label
    add_in_review --> open_pr : error
    open_pr --> await_merge : github.create_pr
    open_pr --> label_failed : error
    await_merge --> merge : pr.mergeable
    await_merge --> label_failed : timeout
    await_merge --> label_failed : error
    merge --> check_close : github.merge
    check_close --> close_issue : close_issue_on_merge is true
    check_close --> done : default
    close_issue --> done : github.close_issue
    close_issue --> done : error
    label_failed --> failed : github.add_label
    label_failed --> failed : error
    done --> [*]
    failed --> [*]</pre
              >
            </div>
          </div>
        </div>

        <h3 id="example-asana">Asana</h3>
        <p>
          For teams that track work in Asana. Polls an Asana project for tasks
          with a specific tag, codes in a container, and opens a PR. The
          <code>label</code> filter matches Asana tag names (case-insensitive).
        </p>
        <div class="example-tabs">
          <div class="tab-bar">
            <button class="tab-btn active" onclick="switchTab(this, 'yaml')">
              yaml
            </button>
            <button class="tab-btn" onclick="switchTab(this, 'diagram')">
              diagram
            </button>
          </div>
          <div data-panel="yaml">
            <div class="code-block">
              <div class="code-header">
                <span class="code-filename">asana.yaml</span>
              </div>
              <pre>
# Asana integration — polls Asana tasks and processes them automatically.
#
# Use this for teams that track work in Asana instead of GitHub Issues.
# Set your Asana project GID in source.filter.project. The label filter
# narrows to only tasks tagged with a matching Asana tag (case-insensitive).
#
# Find your project GID in the Asana URL:
#   https://app.asana.com/0/&lt;PROJECT_GID&gt;/...
#
# Requires: ASANA_PAT environment variable (Personal Access Token)
#
# Highlights:
#   - asana provider with project + tag filter
#   - label filter matches Asana tag names (case-insensitive)
#   - squash merge for clean commit history

workflow: asana-tasks
start: coding

source:
  provider: asana
  filter:
    project: YOUR_ASANA_PROJECT_GID
    label: queued                # Only pick up tasks with this Asana tag

settings:
  max_concurrent: 3
  branch_prefix: asana/
  cleanup_merged: true

states:
  coding:
    type: task
    action: ai.code
    params:
      max_turns: 50
      max_duration: 30m
    next: open_pr
    error: failed

  open_pr:
    type: task
    action: github.create_pr
    params:
      link_issue: true
    next: await_ci
    error: failed

  await_ci:
    type: wait
    event: ci.complete
    timeout: 2h
    params:
      on_failure: retry
    next: await_review
    error: failed

  await_review:
    type: wait
    event: pr.reviewed
    timeout: 48h
    timeout_next: review_overdue
    params:
      auto_address: true
      max_feedback_rounds: 3
    next: merge
    error: failed

  review_overdue:
    type: task
    action: github.comment_pr
    params:
      body: "This PR has been awaiting review for 48h. Could a maintainer take a look?"
    next: failed
    error: failed

  merge:
    type: task
    action: github.merge
    params:
      method: squash
      cleanup: true
    next: done

  done:
    type: succeed

  failed:
    type: fail</pre
              >
            </div>
          </div>
          <div data-panel="diagram" style="display: none">
            <div class="diagram-panel">
              <pre class="mermaid">
stateDiagram-v2
    [*] --> coding
    coding --> open_pr : ai.code
    coding --> failed : error
    open_pr --> await_ci : github.create_pr
    open_pr --> failed : error
    await_ci --> await_review : ci.complete
    await_ci --> failed : error
    await_review --> merge : pr.reviewed
    await_review --> review_overdue : timeout
    await_review --> failed : error
    review_overdue --> failed : github.comment_pr
    review_overdue --> failed : error
    merge --> done : github.merge
    done --> [*]
    failed --> [*]</pre
              >
            </div>
          </div>
        </div>

        <h3 id="example-linear">Linear</h3>
        <p>
          For teams that track work in Linear instead of GitHub Issues. Polls a
          Linear team for issues with a specific label, runs an inline system
          prompt, auto-formats code before opening the PR, and posts a Slack
          notification after merge.
        </p>
        <div class="example-tabs">
          <div class="tab-bar">
            <button class="tab-btn active" onclick="switchTab(this, 'yaml')">
              yaml
            </button>
            <button class="tab-btn" onclick="switchTab(this, 'diagram')">
              diagram
            </button>
          </div>
          <div data-panel="yaml">
            <div class="code-block">
              <div class="code-header">
                <span class="code-filename">linear.yaml</span>
              </div>
              <pre>
# Linear integration — polls Linear issues and processes them automatically.
#
# Use this for teams that track work in Linear instead of GitHub Issues.
# Set your Linear team ID in source.filter.team. The label filter narrows
# to only issues with a matching Linear label (case-insensitive).
#
# Replace "YOUR_LINEAR_TEAM_ID" with your team ID from:
#   Linear → Settings → Teams → &lt;Your Team&gt; → Team ID
#
# Highlights:
#   - linear provider with team + label filter
#   - label filter narrows to Linear issues with the "queued" label
#   - inline system_prompt to embed AI instructions directly in the config
#   - git.format to auto-format code before opening a PR
#   - squash merge for a clean, linear commit history
#   - Slack notification after merge via after hook

workflow: linear-sprint
start: coding

source:
  provider: linear
  filter:
    team: YOUR_LINEAR_TEAM_ID
    label: queued                # Only pick up issues with this Linear label

settings:
  max_concurrent: 3
  branch_prefix: linear/
  cleanup_merged: true

states:
  coding:
    type: task
    action: ai.code
    params:
      max_turns: 50
      max_duration: 30m
      system_prompt: |
        You are an expert software engineer working on this team's codebase.
        Follow the existing code style and architecture patterns exactly.
        Write tests for all new functionality.
        Keep changes focused and minimal — only address what the issue asks for.
        Do not refactor unrelated code or add unrequested features.
    next: format
    error: failed

  # Auto-format code before opening the PR to ensure consistent style.
  # Replace "make fmt" with your project's formatter command, e.g.:
  #   "go fmt ./..." for Go
  #   "npx prettier --write ." for JavaScript/TypeScript
  #   "black ." for Python
  format:
    type: task
    action: git.format
    params:
      command: "make fmt"
    next: open_pr
    error: open_pr             # If formatting fails, open the PR anyway

  open_pr:
    type: task
    action: github.create_pr
    params:
      link_issue: true
    next: await_ci
    error: failed

  await_ci:
    type: wait
    event: ci.complete
    timeout: 2h
    params:
      on_failure: retry        # Keep polling; CI may still pass on a subsequent run
    next: await_review
    error: failed

  await_review:
    type: wait
    event: pr.reviewed
    timeout: 48h
    timeout_next: review_overdue
    params:
      auto_address: true
      max_feedback_rounds: 3
    next: merge
    error: failed

  # Comment on the PR and fail if review takes too long.
  review_overdue:
    type: task
    action: github.comment_pr
    params:
      body: "This PR has been awaiting review for 48h. Could a maintainer take a look?"
    next: failed
    error: failed

  merge:
    type: task
    action: github.merge
    params:
      method: squash
      cleanup: true
    after:
      # Post to Slack after merge. SLACK_WEBHOOK_URL must be set in the environment.
      - run: |
          curl -s -X POST "$SLACK_WEBHOOK_URL" \
            -H 'Content-type: application/json' \
            --data "{\"text\": \"Merged: $ERG_ISSUE_TITLE\\n$ERG_PR_URL\"}"
    next: done

  done:
    type: succeed

  failed:
    type: fail</pre
              >
            </div>
          </div>
          <div data-panel="diagram" style="display: none">
            <div class="diagram-panel">
              <pre class="mermaid">
stateDiagram-v2
    [*] --> coding
    coding --> format : ai.code
    coding --> failed : error
    format --> open_pr : git.format
    format --> open_pr : error
    open_pr --> await_ci : github.create_pr
    open_pr --> failed : error
    await_ci --> await_review : ci.complete
    await_ci --> failed : error
    await_review --> merge : pr.reviewed
    await_review --> review_overdue : timeout
    await_review --> failed : error
    review_overdue --> failed : github.comment_pr
    review_overdue --> failed : error
    merge --> done : github.merge
    merge --> merge_hooks : after hooks
    done --> [*]
    failed --> [*]</pre
              >
            </div>
          </div>
        </div>

        <div
          style="
            margin-top: 3rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border);
            font-size: 0.8rem;
            color: var(--text-dim);
          "
        >
          made by
          <a href="https://www.zhubert.com" style="color: var(--accent)"
            >zack</a
          >
          &middot; mit license
        </div>
      </main>
    </div>

    <script>
      mermaid.initialize({ startOnLoad: false, theme: "dark" });

      function switchTab(btn, tab) {
        var tabs = btn.closest(".example-tabs");
        tabs.querySelectorAll(".tab-btn").forEach(function (b) {
          b.classList.remove("active");
        });
        btn.classList.add("active");
        tabs.querySelectorAll("[data-panel]").forEach(function (p) {
          p.style.display = "none";
        });
        var panel = tabs.querySelector('[data-panel="' + tab + '"]');
        if (panel) panel.style.display = "";
        if (tab === "diagram" && !tabs.dataset.rendered) {
          tabs.dataset.rendered = "1";
          var el = tabs.querySelector(".mermaid");
          if (el) mermaid.run({ nodes: [el] });
        }
      }

      function copyCmd(btn, cmd) {
        navigator.clipboard.writeText(cmd).then(function () {
          btn.textContent = "copied";
          btn.classList.add("copied");
          setTimeout(function () {
            btn.textContent = "copy";
            btn.classList.remove("copied");
          }, 2000);
        });
      }

      function toggleSidebar() {
        document.getElementById("sidebar").classList.toggle("open");
        document.getElementById("sidebarOverlay").classList.toggle("open");
      }

      // Scroll spy for sidebar
      (function () {
        var links = document.querySelectorAll(".sidebar-link");
        var sections = [];
        links.forEach(function (link) {
          var id = link.getAttribute("href");
          if (id && id.startsWith("#")) {
            var el = document.querySelector(id);
            if (el) sections.push({ el: el, link: link });
          }
        });

        function update() {
          var scrollY = window.scrollY + 80;
          var current = sections[0];
          for (var i = 0; i < sections.length; i++) {
            if (sections[i].el.offsetTop <= scrollY) {
              current = sections[i];
            }
          }
          links.forEach(function (l) {
            l.classList.remove("active");
          });
          if (current) current.link.classList.add("active");
        }

        window.addEventListener("scroll", update, { passive: true });
        update();
      })();

      // Close sidebar on link click (mobile)
      document.querySelectorAll(".sidebar-link, .sidebar-sublink").forEach(function (link) {
        link.addEventListener("click", function () {
          if (window.innerWidth <= 860) {
            document.getElementById("sidebar").classList.remove("open");
            document.getElementById("sidebarOverlay").classList.remove("open");
          }
        });
      });

      // Label param-table cells for responsive stacking
      document.querySelectorAll(".param-table").forEach(function (table) {
        var headers = Array.from(table.querySelectorAll("thead th")).map(
          function (th) {
            return th.textContent.trim();
          }
        );
        table.querySelectorAll("tbody tr").forEach(function (row) {
          row.querySelectorAll("td").forEach(function (td, i) {
            if (headers[i]) td.setAttribute("data-label", headers[i]);
          });
        });
      });
    </script>
  </body>
</html>
